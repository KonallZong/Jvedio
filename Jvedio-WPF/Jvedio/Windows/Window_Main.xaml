<super:BaseWindow
    x:Class="Jvedio.Main"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cmd="clr-namespace:Jvedio.Core.Command"
    xmlns:config="clr-namespace:Jvedio;assembly=Jvedio"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:fa="http://schemas.fontawesome.io/icons/"
    xmlns:local="clr-namespace:Jvedio.Core.Extensions"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:media="clr-namespace:Jvedio.Core.Media"
    xmlns:p="clr-namespace:Jvedio.Properties"
    xmlns:super="https://github.com/SuperStudio/SuperControls"
    xmlns:wpftk="clr-namespace:WpfToolkit.Controls;assembly=VirtualizingWrapPanel"
    Title="Jvedio-超级视频管理"
    Width="1200"
    Height="700"
    MinWidth="800"
    MinHeight="500"
    Background="{DynamicResource Window.Background}"
    CloseToTaskBar="{Binding CloseToTaskBar, Source={x:Static config:ConfigManager.Settings}, Mode=OneWay}"
    Closed="Window_Closed"
    Closing="Window_Closing"
    ContentRendered="Window_ContentRendered"
    DataContext="{Binding ElementName=main}"
    Foreground="{DynamicResource Window.Foreground}"
    Icon="pack://application:,,,/Resources/Jvedio.ico"
    PreviewKeyUp="Window_PreviewKeyUp"
    ShowThemeSelector="True"
    TitleAlign="Left"
    TitleHeight="30"
    TitleMargin="5 0"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">


    <super:BaseWindow.Resources>


        <ContextMenu x:Key="TextBlockContextMenu">
            <MenuItem Click="CopyTextBlock" Header="{DynamicResource Copy}" />
        </ContextMenu>

        <Style x:Key="ItemsControlVirtualizedWrapPanelStyle" TargetType="ItemsControl">
            <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True" />
            <Setter Property="ScrollViewer.CanContentScroll" Value="True" />
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <!--<wpftk:VirtualizingWrapPanel />-->
                        <!--<super:VirtualizingWrapPanel />-->
                        <WrapPanel />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <!--<Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ItemsControl">
                        <Border
                            Padding="{TemplateBinding Control.Padding}"
                            Background="{TemplateBinding Panel.Background}"
                            BorderBrush="{TemplateBinding Border.BorderBrush}"
                            BorderThickness="{TemplateBinding Border.BorderThickness}"
                            SnapsToDevicePixels="True">
                            <ScrollViewer Padding="{TemplateBinding Control.Padding}" Focusable="False">
                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>-->
        </Style>

        <Style x:Key="ItemsControlVirtualizedStyle" TargetType="ItemsControl">
            <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True" />
            <Setter Property="ScrollViewer.CanContentScroll" Value="True" />
            <Setter Property="ItemsPanel">
                <Setter.Value>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ItemsControl">
                        <Border
                            Padding="{TemplateBinding Control.Padding}"
                            Background="{TemplateBinding Panel.Background}"
                            BorderBrush="{TemplateBinding Border.BorderBrush}"
                            BorderThickness="{TemplateBinding Border.BorderThickness}"
                            SnapsToDevicePixels="True">
                            <ScrollViewer Padding="{TemplateBinding Control.Padding}" Focusable="False">
                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="MyListBoxItemStyle"
            BasedOn="{StaticResource NormalListBoxItem}"
            TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10,5" />
        </Style>


        <Style
            x:Key="SearchBoxListItemContainerStyle"
            BasedOn="{StaticResource NormalListBoxItem}"
            TargetType="{x:Type ListBoxItem}">
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="FontSize" Value="14" />
        </Style>




        <Style
            x:Key="InfoItemStyle"
            BasedOn="{StaticResource FlatListBoxItem}"
            TargetType="{x:Type ListBoxItem}">
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Background" Value="Red" />
            <!--<Setter Property="ContentTemplate" Value="{StaticResource ListTemplate}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}, Path=DataContext.Tile, FallbackValue=False}" Value="True">
                    <Setter Property="ContentTemplate" Value="{StaticResource TileTemplate}" />
                </DataTrigger>
            </Style.Triggers>-->
        </Style>

        <Style
            x:Key="ActorInfoTextBlock"
            BasedOn="{StaticResource BaseTextBlock}"
            TargetType="{x:Type TextBlock}">
            <Setter Property="Margin" Value="10,10" />
        </Style>


        <Style
            x:Key="ActorTextBox"
            BasedOn="{StaticResource ReadOnlyWrapTextBox}"
            TargetType="{x:Type TextBox}">
            <Setter Property="Width" Value="100" />
            <Setter Property="TextAlignment" Value="Left" />
            <Setter Property="FontSize" Value="15" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="ContextMenu" Value="{StaticResource TextBoxContextMenu}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding EnableEditActress}" Value="True">
                    <Setter Property="Background" Value="{DynamicResource Window.Side.Background}" />
                    <Setter Property="IsReadOnly" Value="False" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style
            x:Key="MenuButton"
            BasedOn="{StaticResource HoverButton}"
            TargetType="{x:Type Button}">
            <Setter Property="Height" Value="40" />
        </Style>

        <Style x:Key="GifImageStyle" TargetType="{x:Type media:GifImage}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding ShowImageMode, Mode=OneWay, Source={x:Static p:Settings.Default}}" Value="0">
                    <Setter Property="SourceType" Value="SmallImage" />
                    <Setter Property="Width" Value="{Binding SmallImage_Width, Source={x:Static p:Settings.Default}, Mode=OneWay}" />
                    <Setter Property="Height" Value="{Binding SmallImage_Height, Source={x:Static p:Settings.Default}, Mode=OneWay}" />

                </DataTrigger>

                <DataTrigger Binding="{Binding ShowImageMode, Mode=OneWay, Source={x:Static p:Settings.Default}}" Value="1">
                    <Setter Property="SourceType" Value="BigImage" />
                    <Setter Property="Width" Value="{Binding BigImage_Width, Source={x:Static p:Settings.Default}, Mode=OneWay}" />
                    <Setter Property="Height" Value="{Binding BigImage_Height, Source={x:Static p:Settings.Default}, Mode=OneWay}" />
                </DataTrigger>

                <DataTrigger Binding="{Binding ShowImageMode, Mode=OneWay, Source={x:Static p:Settings.Default}}" Value="2">
                    <Setter Property="SourceType" Value="Gif" />
                    <Setter Property="Width" Value="{Binding GifImage_Width, Source={x:Static p:Settings.Default}, Mode=OneWay}" />
                    <Setter Property="Height" Value="{Binding GifImage_Height, Source={x:Static p:Settings.Default}, Mode=OneWay}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style
            x:Key="CenterTextBlock"
            BasedOn="{StaticResource BaseTextBlock}"
            TargetType="{x:Type TextBlock}">
            <Setter Property="Padding" Value="5" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="FontSize" Value="20" />
        </Style>



        <Style x:Key="HoverCanvas" TargetType="{x:Type Canvas}">
            <Setter Property="Visibility" Value="Hidden" />
            <Style.Triggers>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}}" Value="False" />
                        <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Grid}, Mode=FindAncestor}}" Value="True" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Visibility" Value="Visible" />
                </MultiDataTrigger>
                <DataTrigger Binding="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}}" Value="True">
                    <Setter Property="Visibility" Value="Hidden" />
                </DataTrigger>
            </Style.Triggers>
        </Style>


        <ContextMenu
            x:Key="VideoContextMenu"
            Opacity="0.9"
            Placement="Mouse"
            PreviewKeyUp="ContextMenu_PreviewKeyUp">
            <MenuItem Click="DownLoadSelectMovie" Header="{DynamicResource SyncInfo}" />
            <MenuItem
                Click="DownLoadWithUrl"
                Header="{DynamicResource Menu_CustomUrl}"
                Visibility="Collapsed" />
            <MenuItem
                Click="EditInfo"
                Header="{DynamicResource Menu_EditInfo}"
                Visibility="{Binding EditMode, Converter={StaticResource BoolToOppositeVisibilityConverter}, Mode=TwoWay, Source={x:Static p:Settings.Default}}" />
            <MenuItem Click="AddToPlayerList" Header="{DynamicResource AddToPlayList}" />
            <MenuItem Name="TagMenuItems" Header="{DynamicResource AddTagStamp}" />
            <MenuItem Header="{DynamicResource Menu_Advance}">
                <MenuItem Click="AddDataAssociation" Header="{DynamicResource DataAsso}" />
                <MenuItem Click="GenerateScreenShot" Header="{DynamicResource Menu_GenerateScreenShot}" />
                <MenuItem Click="GenerateGif" Header="{DynamicResource Menu_GenerateGif}" />
                <MenuItem
                    Click="TranslateMovie"
                    Header="{DynamicResource Menu_Translate}"
                    Visibility="Collapsed" />
                <MenuItem
                    Click="GenerateSmallImage"
                    Header="{DynamicResource Menu_GenerateThumbnail}"
                    Visibility="Collapsed" />
                <MenuItem
                    Click="GenerateActor"
                    Header="{DynamicResource Menu_GenerateActressImage}"
                    Visibility="Collapsed" />
                <MenuItem Click="RenameFile" Header="{DynamicResource Menu_RenameFile}" />
                <MenuItem Click="ReMoveZero" Header="{DynamicResource Menu_RemoveZero}" />
                <MenuItem
                    Click="DeleteDownloadInfo"
                    Header="{DynamicResource ClearDownloadInfo}"
                    Visibility="Collapsed" />

            </MenuItem>


            <Separator />
            <MenuItem
                Click="OpenWeb"
                Header="{DynamicResource ViewWebsite}"
                Icon="pack://application:,,,/Resources/menuitem/openwebsite.png" />

            <MenuItem Header="{DynamicResource OpenPath}" Visibility="{Binding EditMode, Source={x:Static p:Settings.Default}, Converter={StaticResource BoolToOppositeVisibilityConverter}}">
                <MenuItem Click="OpenPath" Header="{DynamicResource Movie}" />
                <MenuItem Click="OpenPath" Header="{DynamicResource Poster}" />
                <MenuItem Click="OpenPath" Header="{DynamicResource Thumbnail}" />
                <MenuItem Click="OpenPath" Header="{DynamicResource Preview}" />
                <MenuItem Click="OpenPath" Header="{DynamicResource ScreenShot}" />
                <MenuItem Click="OpenPath" Header="GIF" />

            </MenuItem>

            <MenuItem Click="CopyFile" Header="{DynamicResource Menu_CopyFile}" />
            <MenuItem Click="CutFile" Header="{DynamicResource CutX}" />

            <Separator />
            <MenuItem
                Click="DeleteID"
                Header="{DynamicResource Menu_DeleteInfo}"
                ToolTip="{DynamicResource ToolTip_DeleteInfo}" />
            <MenuItem
                Click="DeleteFile"
                Header="{DynamicResource Menu_DeleteFile}"
                Icon="pack://application:,,,/Resources/menuitem/clear.png"
                ToolTip="{DynamicResource ToolTip_DeleteFile}" />



        </ContextMenu>

        <!--  影片 template  -->
        <DataTemplate x:Key="VideoDataTemplate">
            <!--  影片加载动画  -->
            <DataTemplate.Triggers>
                <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation
                                FillBehavior="Stop"
                                Storyboard.TargetName="rootGrid"
                                Storyboard.TargetProperty="(UIElement.Opacity)"
                                From="0"
                                To="1"
                                Duration="0:0:0.3" />
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </DataTemplate.Triggers>
            <super:SimplePanel
                Name="rootGrid"
                Width="{Binding GlobalImageWidth, Source={x:Static p:Settings.Default}, Mode=OneWay}"
                Margin="10"
                ContextMenu="{StaticResource VideoContextMenu}"
                ContextMenuOpening="ContextMenu_ContextMenuOpening"
                Tag="{Binding DataID, Mode=OneWay}">
                <Border
                    Name="rootBorder"
                    MinWidth="200"
                    Margin="0"
                    Background="{DynamicResource ListBoxItem.Background}"
                    BorderThickness="2"
                    CornerRadius="3"
                    Effect="{StaticResource BlueDropShadowEffect}"
                    Opacity="{Binding MovieOpacity, Mode=OneWay, Source={x:Static p:Settings.Default}}"
                    Style="{StaticResource SimpleBorder}" />

                <StackPanel Margin="0" Tag="{Binding DataID, Mode=OneWay}">
                    <!--  图片  -->
                    <super:SimplePanel Grid.Row="0">
                        <media:GifImage
                            x:Name="GifImage"
                            Margin="2"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            BigImageSource="{Binding BigImage, Mode=OneWay}"
                            Cursor="Hand"
                            GifSource="{Binding GifUri, Mode=OneWay}"
                            MouseEnter="BorderMouseEnter"
                            MouseLeave="BorderMouseLeave"
                            MouseLeftButtonDown="CanShowDetails"
                            MouseLeftButtonUp="ShowDetails"
                            RenderOptions.BitmapScalingMode="LowQuality"
                            SmallImageSource="{Binding SmallImage, Mode=OneWay}"
                            Stretch="{Binding Path=MainImageAutoMode, Source={x:Static p:Settings.Default}, Converter={StaticResource BoolToImageStretchConverter}, Mode=OneWay}"
                            Style="{StaticResource GifImageStyle}" />

                        <!--  关联视频 + 分段视频  -->
                        <StackPanel
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Panel.ZIndex="3"
                            Orientation="Horizontal">
                            <Button
                                Height="auto"
                                Margin="5"
                                Padding="5"
                                Click="ViewAssocDatas"
                                Cursor="Hand"
                                IsEnabled="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}, Converter={StaticResource OppositeBooleanConverter}}"
                                Style="{StaticResource RoundNormalButton}"
                                Tag="{DynamicResource Button.Hover.Background}"
                                Visibility="{Binding HasAssociation, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">

                                <Image
                                    Width="20"
                                    Height="20"
                                    Source="/Resources/Picture/asso.png" />
                            </Button>
                            <Button
                                Height="auto"
                                Margin="0,5,5,5"
                                Padding="5"
                                Click="ShowSubSection"
                                Cursor="Hand"
                                IsEnabled="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}, Converter={StaticResource OppositeBooleanConverter}}"
                                Style="{StaticResource RoundNormalButton}"
                                Visibility="{Binding HasSubSection, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                                <Button.ContextMenu>
                                    <ContextMenu HorizontalOffset="-50" VerticalOffset="10" />
                                </Button.ContextMenu>
                                <Image
                                    Width="20"
                                    Height="20"
                                    Source="/Resources/Picture/subsection1.png" />
                            </Button>

                        </StackPanel>

                        <!--  播放按钮  -->
                        <Image
                            Height="40"
                            Margin="10,0,10,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Cursor="Hand"
                            MouseLeftButtonUp="PlayVideo"
                            Opacity="0.8"
                            Source="/Resources/Picture/Jvedio.png"
                            ToolTip="{Binding Title, Mode=OneWay}">
                            <Image.Style>
                                <Style TargetType="Image">
                                    <Setter Property="Visibility" Value="Hidden" />
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}}" Value="False" />
                                                <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type super:SimplePanel}, Mode=FindAncestor}}" Value="True" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible" />
                                        </MultiDataTrigger>
                                        <DataTrigger Binding="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}}" Value="True">
                                            <Setter Property="Visibility" Value="Hidden" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Image.Style>
                        </Image>


                    </super:SimplePanel>
                    <!--  标签戳+ID  -->
                    <Grid Grid.Row="1" IsEnabled="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}, Converter={StaticResource OppositeBooleanConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Vertical">
                            <TextBlock
                                Height="20"
                                MaxWidth="150"
                                Margin="0,7"
                                Padding="12,0,0,0"
                                HorizontalAlignment="Left"
                                Cursor="Hand"
                                FontSize="15"
                                MouseLeftButtonDown="CopyVID"
                                Style="{StaticResource BaseTextBlock}"
                                Text="{Binding VID, Mode=OneWay}"
                                TextTrimming="CharacterEllipsis"
                                Visibility="{Binding Path=DisplayID, Converter={StaticResource BoolToVisibilityConverter}, Source={x:Static p:Settings.Default}, Mode=OneWay}" />


                            <!--  日期  -->

                            <TextBlock
                                Height="20"
                                MaxWidth="150"
                                Margin="0,5"
                                Padding="12,0,0,0"
                                HorizontalAlignment="Left"
                                Cursor="Hand"
                                FontSize="15"
                                MouseLeftButtonDown="CopyVID"
                                Opacity="0.5"
                                Style="{StaticResource BaseTextBlock}"
                                Text="{Binding ReleaseDate, Mode=OneWay}"
                                TextAlignment="Left"
                                TextTrimming="WordEllipsis"
                                Visibility="{Binding Path=DisplayDate, Converter={StaticResource BoolToVisibilityConverter}, Source={x:Static p:Settings.Default}, Mode=OneWay}" />

                        </StackPanel>


                        <!--  标签戳  -->

                        <ItemsControl
                            Grid.Column="1"
                            Margin="0,5,5,0"
                            HorizontalAlignment="Right"
                            ItemsSource="{Binding TagStamp}"
                            Tag="{Binding DataID}"
                            Visibility="{Binding Path=DisplayStamp, Converter={StaticResource BoolToVisibilityConverter}, Source={x:Static p:Settings.Default}, Mode=OneWay}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="2"
                                        Padding="4"
                                        Background="{Binding BackgroundBrush}"
                                        BorderThickness="0"
                                        CornerRadius="3"
                                        Tag="{Binding TagID}">
                                        <Border.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Click="DeleteVideoTagStamp" Header="{DynamicResource DeleteTagStamp}" />
                                            </ContextMenu>
                                        </Border.ContextMenu>

                                        <TextBlock Foreground="{Binding ForegroundBrush}" Text="{Binding TagName}" />
                                    </Border>

                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>


                    </Grid>

                    <!--  主界面影片星级  -->
                    <super:Rate
                        Margin="12,2,15,5"
                        AllowHalf="True"
                        Background="{DynamicResource Window.Title.Background}"
                        Foreground="{DynamicResource Common.HighLight.Deep.Background}"
                        IsEnabled="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}, Converter={StaticResource OppositeBooleanConverter}}"
                        ItemHeight="20"
                        ItemMargin="3 0"
                        PreviewMouseLeftButtonDown="StackPanel_PreviewMouseLeftButtonDown"
                        ValueChanged="Rate_ValueChanged"
                        Visibility="{Binding Path=DisplayFavorites, Converter={StaticResource BoolToVisibilityConverter}, Source={x:Static p:Settings.Default}, Mode=OneWay}"
                        Value="{Binding Grade, Mode=TwoWay}" />


                    <TextBlock
                        Height="40"
                        Margin="0,5"
                        Padding="10,0"
                        HorizontalAlignment="Left"
                        Cursor="Hand"
                        FontSize="14"
                        IsEnabled="{Binding EditMode, Mode=OneWay, Source={x:Static p:Settings.Default}, Converter={StaticResource OppositeBooleanConverter}}"
                        MouseLeftButtonDown="CopyVID"
                        Opacity="0.5"
                        Style="{StaticResource BaseTextBlock}"
                        Text="{Binding Title, Mode=OneWay}"
                        TextAlignment="Left"
                        TextTrimming="CharacterEllipsis"
                        ToolTip="{Binding RelativeSource={RelativeSource Mode=Self}, Path=Text}"
                        Visibility="{Binding Path=DisplayTitle, Converter={StaticResource BoolToVisibilityConverter}, Source={x:Static p:Settings.Default}, Mode=OneWay}" />


                </StackPanel>
            </super:SimplePanel>
        </DataTemplate>

        <ContextMenu
            x:Key="SettingsContextMenu"
            Panel.ZIndex="7"
            HorizontalOffset="-45"
            VerticalOffset="-5">
            <MenuItem
                Click="ShowSettingsWindow"
                Header="{DynamicResource Settings}"
                Icon="/Resources/Picture/setting.png" />
            <MenuItem Click="ShowPluginWindow" Header="{DynamicResource Plugin}" />
            <MenuItem Header="{DynamicResource Scan}">
                <MenuItem Click="ImportVideoByPaths" Header="{DynamicResource ScanMultiDir}" />
                <MenuItem Click="ImportVideo" Header="{DynamicResource ScanNas}" />
            </MenuItem>

            <MenuItem Header="高级">
                <MenuItem Click="ManageDataBase" Header="{DynamicResource MovieManagement}" />
                <MenuItem Click="OpenServer" Header="后台服务管理" />
                <MenuItem Click="ClearCache" Header="清空缓存" />
            </MenuItem>
            <MenuItem
                Click="ShowStatistic"
                Header="{DynamicResource Statistic}"
                IsEnabled="False"
                Visibility="Collapsed" />

            <MenuItem
                Click="ShowSponsor"
                Header="{DynamicResource SponsorMe}"
                Visibility="Collapsed" />


            <MenuItem Header="Jvedio">

                <MenuItem
                    Click="ShowAbout"
                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                    Header="{DynamicResource About}"
                    Icon="/Resources/Picture/about.png" />
                <MenuItem Click="OpenHelp" Header="{DynamicResource Help}" />
                <MenuItem Click="OpenFeedBack" Header="{DynamicResource FeedBack}" />
                <MenuItem Click="OpenJvedioWebPage" Header="{DynamicResource WebSite}" />
                <MenuItem
                    Command="cmd:OpenWindow.Thanks"
                    CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                    Header="{DynamicResource Thanks}" />

            </MenuItem>


            <MenuItem Header="{DynamicResource OpenPath}">
                <MenuItem Click="OpenLogPath" Header="{DynamicResource Log}" />
                <MenuItem Click="OpenImageSavePath" Header="{DynamicResource Picture}" />
                <MenuItem Click="OpenApplicationPath" Header="{DynamicResource SoftWare}" />
            </MenuItem>

            <MenuItem
                Click="ShowUpgradeWindow"
                CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                Header="{DynamicResource CheckUpgrade}"
                Icon="/Resources/Picture/update.png" />

        </ContextMenu>

    </super:BaseWindow.Resources>
    <Grid AllowDrop="True">
        <!--  托盘图标  -->
        <Popup
            x:Name="notiIconPopup"
            Width="auto"
            Height="auto"
            AllowsTransparency="True"
            HorizontalOffset="-5"
            Placement="MousePoint"
            PopupAnimation="Fade"
            StaysOpen="False"
            VerticalOffset="-5">
            <Grid Margin="5">
                <Border
                    Margin="5"
                    Background="{DynamicResource Menu.Background}"
                    CornerRadius="2"
                    Effect="{StaticResource PopupDropShadowEffect}" />

                <StackPanel Margin="0,10" Orientation="Vertical">
                    <Button
                        Margin="5,0"
                        Padding="20,7"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Background}"
                        Click="ShowMainWindow"
                        Content="{DynamicResource OpenJvedio}"
                        Style="{StaticResource FlatButton}" />
                    <Button
                        Margin="5,0"
                        Padding="20,7"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Background}"
                        Command="cmd:OpenWindow.Settings"
                        Content="{DynamicResource Settings}"
                        Style="{StaticResource FlatButton}" />
                    <Button
                        Margin="5,0"
                        Padding="20,7"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Background}"
                        Click="ShowUpgradeWindow"
                        CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"
                        Content="{DynamicResource CheckUpgrade}"
                        Style="{StaticResource FlatButton}" />

                    <Button
                        Margin="5,0"
                        Padding="20,7"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Deep.Background}"
                        Click="Notify_Close"
                        Content="{DynamicResource Exit}"
                        Style="{StaticResource FlatButton}" />
                </StackPanel>

            </Grid>
        </Popup>

        <!--  影片关联弹框  -->
        <Popup
            x:Name="AssoDataPopup"
            Width="{x:Static SystemParameters.PrimaryScreenWidth}"
            Height="auto"
            AllowsTransparency="True"
            Placement="MousePoint"
            PopupAnimation="Fade"
            StaysOpen="True"
            VerticalOffset="0">
            <Grid Margin="5">
                <Border
                    Margin="5"
                    Background="{DynamicResource Menu.Background}"
                    CornerRadius="5"
                    Effect="{StaticResource PopupDropShadowEffect}" />


                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Border CornerRadius="5 5 0 0" Style="{StaticResource InfoBorder}">
                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                            <TextBlock
                                Grid.Row="0"
                                FontWeight="Bold"
                                Style="{StaticResource BaseTextBlock}"
                                Text="关联影片" />
                            <TextBlock
                                Foreground="{DynamicResource Window.Sub.Foreground}"
                                Style="{StaticResource BaseTextBlock}"
                                Text="{Binding ViewAssociationDatas.Count, StringFormat=\ ({0})}" />
                        </StackPanel>
                    </Border>
                    <super:HoverPath
                        Grid.Row="0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Click="HideAssocPopup"
                        Style="{StaticResource CloseHoverPath}" />

                    <ScrollViewer
                        Grid.Row="1"
                        Margin="5"
                        CanContentScroll="True"
                        FocusVisualStyle="{x:Null}"
                        HorizontalScrollBarVisibility="Auto"
                        IsDeferredScrollingEnabled="False"
                        PreviewMouseWheel="ScrollViewer_MouseWheel"
                        VerticalScrollBarVisibility="Hidden">
                        <ItemsControl
                            Name="assoItemsControl"
                            Margin="5,5,5,5"
                            Background="Transparent"
                            ItemTemplate="{StaticResource VideoDataTemplate}"
                            ItemsSource="{Binding ViewAssociationDatas}"
                            ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                        </ItemsControl>
                    </ScrollViewer>

                </Grid>

            </Grid>
        </Popup>

        <Grid Margin="0" PreviewMouseLeftButtonDown="Grid_PreviewMouseLeftButtonDown">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Name="SideGridColumn"
                            Width="{Binding SideGridWidth, FallbackValue=200, Mode=OneWay}"
                            MaxWidth="500" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <!--  侧边栏  -->
                    <Border
                        Grid.Column="0"
                        Background="{DynamicResource Window.Side.Background}"
                        SizeChanged="SideBorder_SizeChanged">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />

                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <super:HoverPath
                                    Click="GoToStartUp"
                                    Style="{StaticResource HomeHoverPath}"
                                    ToolTip="{DynamicResource Return}" />


                                <ComboBox
                                    Grid.Column="1"
                                    DisplayMemberPath="Name"
                                    ItemsSource="{Binding DataBases}"
                                    SelectedIndex="{Binding CurrentDbId, Mode=OneWay}"
                                    SelectedValuePath="DBId"
                                    SelectionChanged="DatabaseComboBox_SelectionChanged"
                                    Style="{StaticResource RoundComboBox}"
                                    ToolTip="{Binding RelativeSource={RelativeSource Mode=Self}, Path=Text}" />
                            </Grid>



                            <ScrollViewer
                                Grid.Row="1"
                                Width="{Binding ElementName=SideBorder, Path=ActualWidth}"
                                VerticalScrollBarVisibility="Hidden">
                                <Grid Width="{Binding ElementName=SideBorder, Path=ActualWidth}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="auto" />
                                    </Grid.RowDefinitions>

                                    <super:TogglePanel
                                        Grid.Row="0"
                                        Margin="1,0"
                                        Padding="0,4"
                                        FontSize="14"
                                        Header="{DynamicResource Default}"
                                        IsExpanded="{Binding SideDefaultExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, FallbackValue=true}"
                                        IsSelected="False"
                                        LineWidth="0"
                                        Style="{StaticResource BaseTogglePanel}">
                                        <StackPanel>
                                            <super:PathRadioButton
                                                Command="{Binding SelectCommand}"
                                                CommandParameter="All"
                                                IsChecked="{Binding MainDataChecked, Mode=OneWay}"
                                                MainText="{DynamicResource AllVideo}"
                                                Path="{StaticResource GeoVideo}"
                                                Style="{StaticResource BasePathRadioButton}"
                                                SubText="{Binding AllVideoCount}" />
                                            <super:PathRadioButton
                                                Command="{Binding SelectCommand}"
                                                CommandParameter="Favorite"
                                                MainText="{DynamicResource Favorites}"
                                                Path="{StaticResource GeoStar}"
                                                Style="{StaticResource BasePathRadioButton}"
                                                SubText="{Binding FavoriteVideoCount}" />
                                            <super:PathRadioButton
                                                Command="{Binding SelectCommand}"
                                                CommandParameter="RecentWatch"
                                                MainText="{DynamicResource RecentPlay}"
                                                Path="{StaticResource GeoRecentPlay}"
                                                Style="{StaticResource BasePathRadioButton}"
                                                SubText="{Binding RecentWatchCount}">
                                                <super:PathRadioButton.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Click="ClearRecentWatched" Header="{DynamicResource Clear}" />
                                                    </ContextMenu>
                                                </super:PathRadioButton.ContextMenu>
                                            </super:PathRadioButton>
                                            <super:PathRadioButton
                                                Click="ShowActorNotice"
                                                Command="{Binding ShowActorsCommand}"
                                                MainText="{DynamicResource Actors}"
                                                Path="{StaticResource GeoActor}"
                                                Style="{StaticResource BasePathRadioButton}"
                                                SubText="{Binding AllActorCount}" />
                                            <super:PathRadioButton
                                                Command="{Binding ShowLabelsCommand}"
                                                MainText="{DynamicResource MyLabel}"
                                                Path="{StaticResource GeoLabel}"
                                                Style="{StaticResource BasePathRadioButton}"
                                                SubText="{Binding AllLabelCount}" />
                                            <super:PathRadioButton
                                                Command="{Binding ShowClassifyCommand}"
                                                MainText="{DynamicResource AutoClassification}"
                                                Path="{StaticResource GeoClassify}"
                                                Style="{StaticResource BasePathRadioButton}"
                                                SubText="" />
                                        </StackPanel>
                                    </super:TogglePanel>
                                    <super:SimplePanel Grid.Row="1">
                                        <ToggleButton
                                            Width="20"
                                            Height="20"
                                            Margin="0,3,32,0"
                                            Padding="0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Panel.ZIndex="20"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            Click="SetTagStampsSelected"
                                            IsChecked="True"
                                            Style="{StaticResource FlatToggleButton}">
                                            <Border
                                                Margin="0"
                                                CornerRadius="5"
                                                Tag="{DynamicResource Window.Title.Hover.Background}">
                                                <Viewbox
                                                    Width="14"
                                                    Height="auto"
                                                    VerticalAlignment="Center">
                                                    <Path
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Data="M412.16 738.304a51.2 51.2 0 0 1 0 69.12l-3.072 3.328L210.432 998.4a51.2 51.2 0 0 1-67.072 2.816L140.032 998.4 16.384 880.64a51.2 51.2 0 0 1 67.072-76.8l3.328 2.816 88.832 84.224 164.096-153.6a51.2 51.2 0 0 1 72.448 2.304zM972.8 824.576a51.2 51.2 0 0 1 0 102.4H563.2a51.2 51.2 0 0 1 0-102.4zM412.16 379.904a51.2 51.2 0 0 1 0 69.376l-3.072 3.072L210.432 640a51.2 51.2 0 0 1-67.072 2.816L140.032 640 16.384 522.24a51.2 51.2 0 0 1 67.072-76.8l3.328 2.816 88.832 84.48 164.096-153.6a51.2 51.2 0 0 1 72.448 2.048zM972.8 466.176a51.2 51.2 0 0 1 0 102.4H563.2a51.2 51.2 0 0 1 0-102.4zM412.16 21.76a51.2 51.2 0 0 1 0 69.12l-2.56 3.072L210.432 281.6a51.2 51.2 0 0 1-67.072 2.816L140.032 281.6 16.384 163.84a51.2 51.2 0 0 1 67.072-76.8l3.328 3.072L175.616 174.08l164.096-153.6a51.2 51.2 0 0 1 72.448 1.28zM972.8 108.032a51.2 51.2 0 0 1 44.288 76.8 51.2 51.2 0 0 1-44.288 25.6H563.2a51.2 51.2 0 0 1-44.288-25.6 51.2 51.2 0 0 1 44.288-76.8z m0 0"
                                                        Fill="{DynamicResource Window.Foreground}" />
                                                </Viewbox>

                                            </Border>
                                        </ToggleButton>
                                        <super:HoverPath
                                            Width="23"
                                            Height="23"
                                            Margin="3,2,3,0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Panel.ZIndex="6"
                                            Click="NewTagStamp"
                                            Style="{StaticResource AddHoverPath}"
                                            ToolTip="{DynamicResource Add}" />
                                        <super:TogglePanel
                                            Height="auto"
                                            Margin="1,0"
                                            Padding="0,4"
                                            FontSize="14"
                                            Header="{DynamicResource TagStamp}"
                                            IsExpanded="{Binding SideTagStampExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, FallbackValue=true}"
                                            IsSelected="False"
                                            LineWidth="0"
                                            Style="{StaticResource BaseTogglePanel}">
                                            <ItemsControl
                                                x:Name="TagStampItemsControl"
                                                Background="Transparent"
                                                ItemsSource="{Binding TagStamps}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <super:PathCheckButton
                                                            Name="pathCheckButton"
                                                            Height="30"
                                                            Margin="0"
                                                            CheckedBrush="{DynamicResource Window.Side.Hover.Background}"
                                                            Click="PathCheckButton_Click"
                                                            CornerRadius="0"
                                                            Fill="{Binding BackgroundBrush}"
                                                            FontSize="12"
                                                            Foreground="{DynamicResource Window.Foreground}"
                                                            IsChecked="{Binding Selected, Mode=TwoWay}"
                                                            MainText="{Binding TagName}"
                                                            Path="M121.6 247.872h780.8c23.488 0 42.496 19.008 42.496 42.496v417.92a42.496 42.496 0 0 1-42.496 42.496H121.6a42.496 42.496 0 0 1-42.496-42.496v-417.92a42.496 42.496 0 0 1 42.496-42.496z"
                                                            PathHeight="20"
                                                            PathMargin="5 -5 5 0"
                                                            SubText="{Binding Count}"
                                                            Tag="{Binding TagID}">
                                                            <super:PathCheckButton.ContextMenu>
                                                                <ContextMenu>
                                                                    <MenuItem Click="EditTagStamp" Header="{DynamicResource Edit}" />
                                                                    <MenuItem
                                                                        super:CommonExt.HoverBackground="{DynamicResource Menu.Hover.Deep.Background}"
                                                                        Click="DeleteTagStamp"
                                                                        Header="{DynamicResource Delete}" />
                                                                </ContextMenu>
                                                            </super:PathCheckButton.ContextMenu>
                                                        </super:PathCheckButton>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>


                                        </super:TogglePanel>
                                    </super:SimplePanel>

                                </Grid>
                            </ScrollViewer>
                            <Button
                                Grid.Row="2"
                                Margin="20,10"
                                Padding="10"
                                HorizontalAlignment="Stretch"
                                Click="ImportVideo"
                                Style="{StaticResource ButtonMain}">
                                <StackPanel Orientation="Horizontal">
                                    <Image
                                        Height="13"
                                        Margin="0,0,5,0"
                                        Source="/Resources/Picture/导入.png" />
                                    <TextBlock Text="{DynamicResource ImportVideo}" />
                                </StackPanel>
                            </Button>
                            <Grid
                                Grid.Row="3"
                                Margin="0,0,5,5"
                                VerticalAlignment="Bottom">
                                <Image
                                    Height="20"
                                    Margin="20,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Source="/Resources/Picture/Title.png"
                                    ToolTip="Jvedio" />

                                <super:HoverPath
                                    Width="30"
                                    Height="30"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    ContextMenu="{StaticResource SettingsContextMenu}"
                                    Style="{StaticResource SettingHoverPath}"
                                    ToolTip="{DynamicResource Settings}" />
                            </Grid>

                        </Grid>

                    </Border>

                    <!--  左右调节  -->
                    <GridSplitter
                        Grid.Column="0"
                        Width="5"
                        Panel.ZIndex="10"
                        Style="{StaticResource HoverSpliter}" />


                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <super:NoticeViewer x:Name="noticeViewer" Grid.Row="0" />

                        <super:SimplePanel Grid.Row="1">
                            <!--  搜索  -->
                            <super:SearchBox
                                Name="searchBox"
                                Margin="0"
                                HideClearButtonOnMouseLeave="False"
                                PreviewKeyDown="searchBox_PreviewKeyDown"
                                PreviewKeyUp="SearchBar_PreviewKeyUp"
                                Search="doSearch"
                                SearchOnTextChanged="False"
                                Style="{StaticResource SearchBoxStyle}"
                                Text="{Binding SearchText, Mode=TwoWay}"
                                Visibility="{Binding DisplaySearchBox, Source={x:Static p:Settings.Default}, Converter={StaticResource BoolToVisibilityConverter}}" />
                            <Popup
                                x:Name="searchResultPopup"
                                Width="{Binding ElementName=searchBox, Path=ActualWidth}"
                                MinHeight="300"
                                AllowsTransparency="True"
                                HorizontalOffset="-5"
                                IsOpen="{Binding Searching}"
                                Placement="Bottom"
                                PlacementTarget="{Binding ElementName=searchBox}"
                                PopupAnimation="Fade"
                                StaysOpen="False"
                                VerticalOffset="-5">
                                <Grid Margin="5">
                                    <Border
                                        Margin="5"
                                        Background="{DynamicResource Menu.Background}"
                                        CornerRadius="0 0 5 5"
                                        Effect="{StaticResource PopupDropShadowEffect}" />
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="auto" />
                                        </Grid.RowDefinitions>

                                        <TabControl
                                            Name="searchTabControl"
                                            Grid.Row="0"
                                            Margin="10,10,10,0"
                                            Background="Transparent"
                                            FocusVisualStyle="{x:Null}"
                                            ItemContainerStyle="{StaticResource FlatTabItem}"
                                            SelectedIndex="{Binding SearchSelectedIndex, Mode=TwoWay}"
                                            Style="{StaticResource FlatTabControl}">
                                            <TabItem Header="{DynamicResource ID}" />
                                            <TabItem Header="{DynamicResource Title}" />
                                            <TabItem Header="{DynamicResource Path}" />
                                            <TabItem Header="{DynamicResource Actors}" />
                                            <TabItem Header="{DynamicResource Label}" />
                                            <TabItem Header="{DynamicResource Genre}" />
                                            <TabItem Header="{DynamicResource Tag}" />
                                            <TabItem Header="{DynamicResource Studio}" />
                                            <TabItem Header="{DynamicResource Director}" />
                                        </TabControl>
                                        <Grid
                                            Grid.Row="1"
                                            Margin="5"
                                            Background="{DynamicResource Menu.Background}"
                                            Visibility="Collapsed">
                                            <TabControl TabStripPlacement="Bottom">
                                                <TabItem Header="2022-07">
                                                    <WrapPanel Orientation="Horizontal" />
                                                </TabItem>
                                                <TabItem Header="2022-06" />
                                            </TabControl>



                                        </Grid>
                                    </Grid>
                                </Grid>
                            </Popup>
                        </super:SimplePanel>

                        <Grid Grid.Row="2" Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <!--  选项 tabitem 栏  -->
                            <ScrollViewer
                                Grid.Row="1"
                                VerticalAlignment="Top"
                                HorizontalScrollBarVisibility="Auto"
                                PreviewMouseWheel="PortTab_PreviewMouseWheel"
                                VerticalScrollBarVisibility="Hidden">
                                <ItemsControl AlternationCount="999" ItemsSource="{Binding TabItems}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Height="30"
                                                MinWidth="150"
                                                BorderThickness="0"
                                                CornerRadius="5 5 0 0"
                                                Cursor="Hand"
                                                PreviewMouseLeftButtonDown="BeginDragTabItem"
                                                PreviewMouseLeftButtonUp="SetPortSelected"
                                                PreviewMouseMove="Border_PreviewMouseMove"
                                                Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=(ItemsControl.AlternationIndex)}">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="{DynamicResource TabItem.Background}" />
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource TabItem.Hover.Background}" />
                                                            </Trigger>
                                                            <DataTrigger Binding="{Binding Selected}" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource ListBoxItem.Selected.Active.Background}" />
                                                            </DataTrigger>

                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Border.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Click="CloseCurrentTab" Header="关闭" />
                                                        <MenuItem Click="CloseOtherTab" Header="关闭其它" />
                                                        <MenuItem Click="CloseAllLeftTab" Header="关闭左边所有" />
                                                        <MenuItem Click="CloseAllRightTab" Header="关闭右边所有" />
                                                        <MenuItem Click="CloseAllTabs" Header="关闭所有" />
                                                        <Separator />
                                                        <MenuItem Click="MoveToFirst" Header="移到最前" />
                                                        <MenuItem Click="MoveToLast" Header="移到最后" />
                                                        <Separator />
                                                        <MenuItem
                                                            Click="PinTab"
                                                            Header="固定"
                                                            IsCheckable="True"
                                                            IsChecked="{Binding Pinned, Mode=OneWay}" />
                                                        <Separator />
                                                    </ContextMenu>
                                                </Border.ContextMenu>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="30" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <super:LoadingCircle
                                                        Grid.Column="0"
                                                        Width="17"
                                                        Height="17"
                                                        Margin="5"
                                                        DotSize="3"
                                                        Visibility="{Binding Loading, Converter={StaticResource BoolToVisibilityConverter}}" />

                                                    <Viewbox
                                                        Grid.Column="0"
                                                        Width="15"
                                                        Height="15"
                                                        Margin="5"
                                                        Visibility="{Binding Loading, Converter={StaticResource BoolToOppositeVisibilityConverter}}">
                                                        <Path Data="{Binding TabGeometry}" Fill="{DynamicResource Window.Foreground}" />
                                                    </Viewbox>
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        MaxWidth="120"
                                                        Margin="0"
                                                        Padding="10,5"
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{Binding Name}"
                                                        TextTrimming="WordEllipsis"
                                                        TextWrapping="WrapWithOverflow" />

                                                    <Grid Grid.Column="3">
                                                        <super:HoverPath
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5"
                                                            VerticalAlignment="Center"
                                                            Panel.ZIndex="2"
                                                            PreviewMouseLeftButtonDown="PinTab"
                                                            Style="{StaticResource PinHoverPath}"
                                                            Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=(ItemsControl.AlternationIndex)}"
                                                            Visibility="{Binding Pinned, Converter={StaticResource BoolToVisibilityConverter}}" />


                                                        <super:HoverPath
                                                            Width="10"
                                                            Height="10"
                                                            Margin="5"
                                                            VerticalAlignment="Center"
                                                            super:CommonExt.HoverBackground="{DynamicResource Window.Title.Hover.Background}"
                                                            PreviewMouseLeftButtonDown="CloseTabItem"
                                                            Style="{StaticResource CloseExHoverPath}"
                                                            Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=(ItemsControl.AlternationIndex)}"
                                                            Visibility="{Binding Pinned, Converter={StaticResource BoolToOppositeVisibilityConverter}}" />

                                                    </Grid>


                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>

                        <TabControl
                            Grid.Row="2"
                            Background="Transparent"
                            FocusVisualStyle="{x:Null}"
                            ItemContainerStyle="{StaticResource FlatTabItem}"
                            SelectedIndex="{Binding TabSelectedIndex, FallbackValue=0}"
                            Style="{StaticResource FlatTabControl}"
                            Visibility="Collapsed">
                            <TabItem Header="{DynamicResource Movie}">
                                <!--  影片  -->
                                <Grid HorizontalAlignment="Stretch">

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="auto" />
                                    </Grid.RowDefinitions>


                                    <!--  工具栏  -->
                                    <Grid
                                        Grid.Row="0"
                                        Panel.ZIndex="4"
                                        Background="Transparent"
                                        Visibility="{Binding DisplayFunBar, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay, Source={x:Static p:Settings.Default}}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="auto" />
                                            <RowDefinition Height="auto" />
                                        </Grid.RowDefinitions>

                                        <StackPanel Grid.Row="0" Orientation="Horizontal">


                                            <Button
                                                Margin="5"
                                                Padding="10"
                                                Command="{Binding AddNewMovie}"
                                                Style="{StaticResource ButtonMain}"
                                                Visibility="{Binding Path=TeenMode, Source={x:Static config:ConfigManager.Settings}, Converter={StaticResource BoolToOppositeVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Image
                                                        Height="13"
                                                        Margin="0,0,5,0"
                                                        Source="/Resources/Picture/新增.png" />
                                                    <TextBlock Text="{DynamicResource ID}" />
                                                </StackPanel>
                                            </Button>


                                            <TextBlock
                                                Margin="10,0,5,0"
                                                VerticalAlignment="Center"
                                                FontSize="14"
                                                Foreground="{DynamicResource Window.Foreground}"
                                                Style="{StaticResource BaseTextBlock}"
                                                Text="{DynamicResource Edit}" />

                                            <super:Switch
                                                Height="20"
                                                Background="{DynamicResource Window.Title.Background}"
                                                CheckedBackground="{DynamicResource CheckBox.Checked.Background}"
                                                Click="SetSelectMode"
                                                IsChecked="{Binding EditMode, Mode=TwoWay, Source={x:Static p:Settings.Default}}" />



                                            <super:HoverPath
                                                Margin="5,0"
                                                Click="RandomDisplay"
                                                Data="{StaticResource GeoRandom}"
                                                ToolTip="{DynamicResource ToolTip_RandomShow}" />

                                            <super:HoverPath
                                                Margin="5,0"
                                                Click="ShowFilterGrid"
                                                Data="M452.923077 512v275.692308l118.153846-98.461539v-177.230769l177.230769-177.230769H275.692308l177.230769 177.230769zM0 512C0 229.218462 229.238154 0 512 0c282.781538 0 512 229.238154 512 512 0 282.781538-229.238154 512-512 512C229.218462 1024 0 794.761846 0 512z"
                                                ToolTip="{StaticResource Filter}" />


                                            <Border
                                                VerticalAlignment="Center"
                                                Background="{DynamicResource Window.Side.Background}"
                                                CornerRadius="5">
                                                <StackPanel Name="ViewModeStackPanel" Orientation="Horizontal">
                                                    <super:PathRadioButton
                                                        Width="25"
                                                        CornerRadius="5,0,0,5"
                                                        Fill="{DynamicResource Window.Foreground}"
                                                        Path="M886.680128 13.86578H136.468464c-37.340302 0-62.274379 24.934078-62.274379 62.274379v871.841311c0 37.340302 24.934078 62.274379 62.274379 62.27438h750.211664c37.340302 0 62.274379-24.934078 62.27438-62.27438V76.140159c0-37.340302-24.934078-62.274379-62.27438-62.274379zM136.468464 76.140159h750.211664V617.878608L710.682029 451.002732 442.731916 730.021143 318.061527 617.878608 136.468464 792.295522V76.140159z m0 871.841311v-78.572752l184.025656-170.524765L599.75579 947.98147H136.468464z m549.401117 0l-200.688918-181.836322 225.501366-234.258701 175.998099 164.321654v251.65174H685.869581z m0 0"
                                                        PathHeight="15"
                                                        PathMargin="5 0 3 0"
                                                        Style="{StaticResource PathGroupRadioButton}"
                                                        ToolTip="{DynamicResource Thumbnail}" />
                                                    <super:PathRadioButton
                                                        Padding="0,0,0,0"
                                                        CornerRadius="0 5 5 0"
                                                        Fill="{DynamicResource Window.Foreground}"
                                                        IsChecked="True"
                                                        Path="M934.4 107.52H89.6c-20.48 0-35.84 15.36-35.84 35.84V883.2c0 20.48 15.36 35.84 35.84 35.84h844.8c20.48 0 35.84-15.36 35.84-35.84V143.36c0-20.48-15.36-35.84-35.84-35.84z m-35.84 739.84H125.44V176.64h775.68v670.72h-2.56z m0 0 M335.36 440.32c38.4 0 71.68-30.72 71.68-71.68 0-38.4-30.72-71.68-71.68-71.68-38.4 0-71.68 30.72-71.68 71.68 2.56 40.96 33.28 71.68 71.68 71.68z m0 0M652.8 396.8L445.44 691.2 337.92 540.16 158.72 793.6h704L652.8 396.8z m0 0"
                                                        PathHeight="15"
                                                        Style="{StaticResource PathGroupRadioButton}"
                                                        ToolTip="{DynamicResource Poster}" />
                                                    <super:PathRadioButton
                                                        CornerRadius="0"
                                                        Path="M1024 170.666667v682.666666H0V170.666667h1024zM85.333333 256v512h853.333334V256H85.333333z m354.133334 280.106667c0 82.730667-51.477333 133.333333-136.469334 133.333333-92.501333 0-148.117333-59.776-148.117333-158.72 0-97.706667 55.829333-158.144 146.026667-158.144 73.344 0 127.936 42.709333 135.424 106.24h-75.413334c-7.509333-26.453333-29.994667-42.474667-60.010666-42.474667-42.688 0-68.117333 34.986667-68.117334 93.525334 0 59.584 28.117333 95.850667 71.893334 95.850666 34.773333 0 58.944-20.416 60.8-50.837333l0.213333-5.013333h-54.997333v-52.48H439.466667v38.741333zM573.013333 661.333333h-76.48V360.704h76.458667V661.333333z m147.285334 0H643.84V360.704h204.586667v61.461333h-128.128v68.544h116.245333v58.538667h-116.266667V661.333333z"
                                                        PathHeight="19"
                                                        Style="{StaticResource PathGroupRadioButton}"
                                                        ToolTip="GIF"
                                                        Visibility="Collapsed" />
                                                    <super:PathRadioButton
                                                        CornerRadius="0,5,5,0"
                                                        Path="M64 480h352V128H64v352z m64-288h224v224H128V192zM64 928h352V576H64v352z m64-288h224v224H128v-224zM526.848 224H928a32 32 0 1 0 0-64H526.848a32 32 0 0 0 0 64zM928 608H526.848a32 32 0 1 0 0 64H928a32 32 0 1 0 0-64zM928 384H526.848a32 32 0 0 0 0 64H928a32 32 0 1 0 0-64zM928 832H526.848a32 32 0 1 0 0 64H928a32 32 0 1 0 0-64z"
                                                        PathHeight="19"
                                                        Style="{StaticResource PathGroupRadioButton}"
                                                        Visibility="Collapsed" />
                                                </StackPanel>
                                            </Border>

                                            <super:HoverPath
                                                Name="SortBorder"
                                                MenuOnLeftClick="True"
                                                Style="{StaticResource SortHoverPath}"
                                                ToolTip="{DynamicResource Sorting}">
                                                <super:HoverPath.ContextMenu>
                                                    <ContextMenu HorizontalOffset="-50">
                                                        <MenuItem Header="{DynamicResource ID}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Favorites}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource FileSize}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource ImportDate}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource CreatedDate}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Title}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource ViewNumber}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource ReleaseDate}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Rating}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Duration}" IsCheckable="True" />
                                                    </ContextMenu>
                                                </super:HoverPath.ContextMenu>
                                            </super:HoverPath>


                                        </StackPanel>
                                    </Grid>

                                    <!--  字母导航栏  -->
                                    <Grid
                                        Grid.Row="1"
                                        MinWidth="40"
                                        MinHeight="50"
                                        Margin="20"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Panel.ZIndex="4"
                                        Opacity="0"
                                        Visibility="{Binding DisplayNavigation, Source={x:Static p:Settings.Default}, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <Rectangle
                                            Margin="{Binding MainGridThickness, Converter={StaticResource SmallerThicknessConverter}, ConverterParameter=-5, FallbackValue=5}"
                                            Effect="{StaticResource ZeroShadowEffect}"
                                            Fill="{DynamicResource Window.Side.Background}"
                                            Opacity="0.5"
                                            RadiusX="2"
                                            RadiusY="2"
                                            Stroke="#5AC6FC"
                                            StrokeThickness="1" />
                                        <ScrollViewer Margin="0,10" VerticalScrollBarVisibility="Hidden">
                                            <ItemsControl HorizontalAlignment="Center" ItemsSource="{Binding LettersNavigation}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Button
                                                            Click="NavigationToLetter"
                                                            Content="{Binding}"
                                                            Style="{StaticResource NavigateButton}" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                        </ScrollViewer>

                                    </Grid>


                                    <!--  信息展示：演员信息+影片展示  -->
                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <!--  演员  -->

                                        <Frame x:Name="actorFrame" Visibility="{Binding ShowActorGrid, Converter={StaticResource BoolToVisibilityConverter}}" />

                                        <!--  影片  -->
                                        <super:SimplePanel
                                            Grid.Column="1"
                                            Panel.ZIndex="2"
                                            AllowDrop="True"
                                            DragOver="Grid_DragOver"
                                            Drop="Grid_Drop"
                                            FocusVisualStyle="{x:Null}">
                                            <super:SimplePanel.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem
                                                        Click="SelectAll"
                                                        FontWeight="Bold"
                                                        Header="{DynamicResource SelectAll}" />
                                                    <Separator />
                                                    <MenuItem Name="DataExistMenuItem" Header="{DynamicResource IsExisted}">
                                                        <MenuItem
                                                            Header="{DynamicResource Default}"
                                                            IsCheckable="True"
                                                            IsChecked="True" />
                                                        <MenuItem Header="{DynamicResource NotExists}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Existed}" IsCheckable="True" />
                                                    </MenuItem>
                                                    <MenuItem
                                                        Click="LoadData"
                                                        Header="{DynamicResource ShowSubSection}"
                                                        IsCheckable="True"
                                                        IsChecked="{Binding OnlyShowSubSection, Source={x:Static p:Settings.Default}, Mode=TwoWay}" />

                                                    <MenuItem Name="VideoTypeMenuItem" Header="{DynamicResource VideoType}">
                                                        <MenuItem Header="{DynamicResource Normal}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Uncensored}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Censored}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource Europe}" IsCheckable="True" />
                                                    </MenuItem>
                                                    <MenuItem Name="PictureFilterType" Header="{DynamicResource ImageExisted}">
                                                        <MenuItem
                                                            Header="{DynamicResource Default}"
                                                            IsCheckable="True"
                                                            IsChecked="True" />
                                                        <MenuItem Header="{DynamicResource NoImage}" IsCheckable="True" />
                                                        <MenuItem Header="{DynamicResource WithImage}" IsCheckable="True" />
                                                    </MenuItem>
                                                    <Separator />
                                                    <MenuItem Header="{DynamicResource AllData}">
                                                        <MenuItem Click="GenerateAllScreenShot" Header="{DynamicResource Menu_GenerateScreenShot}" />
                                                        <MenuItem Click="DownloadAllVideo" Header="{DynamicResource SyncInfo}" />
                                                    </MenuItem>
                                                </ContextMenu>
                                            </super:SimplePanel.ContextMenu>

                                            <StackPanel
                                                Grid.RowSpan="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Orientation="Vertical"
                                                Visibility="{Binding ShowSoft, Converter={StaticResource BoolToVisibilityConverter}}">

                                                <Image
                                                    Grid.Row="0"
                                                    Height="128"
                                                    Margin="10"
                                                    Source="pack://application:,,,/Resources/Picture/Jvedio.png">
                                                    <Image.Effect>
                                                        <DropShadowEffect
                                                            BlurRadius="4"
                                                            Direction="315"
                                                            Opacity="1"
                                                            ShadowDepth="5"
                                                            Color="Black" />
                                                    </Image.Effect>
                                                </Image>
                                                <TextBlock
                                                    Grid.Row="1"
                                                    FontSize="25"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="{DynamicResource ThanksUseJvedio}">
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            BlurRadius="4"
                                                            Direction="315"
                                                            Opacity="1"
                                                            ShadowDepth="5"
                                                            Color="Black" />
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                                <TextBlock
                                                    Grid.Row="2"
                                                    FontSize="15"
                                                    Foreground="{DynamicResource Window.Sub.Foreground}"
                                                    Style="{StaticResource BaseTextBlock}"
                                                    Text="@Jvedio Copyright © 2020">
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect
                                                            BlurRadius="4"
                                                            Direction="315"
                                                            Opacity="1"
                                                            ShadowDepth="5"
                                                            Color="Black" />
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                            </StackPanel>

                                            <!--  拖入视频时显示  -->
                                            <super:SimplePanel
                                                x:Name="dragOverBorder"
                                                Margin="5,0"
                                                Panel.ZIndex="99"
                                                Visibility="Collapsed">
                                                <Border
                                                    Background="{DynamicResource Window.Title.Background}"
                                                    CornerRadius="5"
                                                    Effect="{StaticResource BlueDropShadowEffect}"
                                                    Opacity="0.8"
                                                    PreviewDragLeave="Grid_DragLeave" />

                                                <StackPanel
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Background="Transparent"
                                                    DragEnter="Grid_DragOver"
                                                    Orientation="Vertical">
                                                    <Image
                                                        Height="100"
                                                        Margin="10,30"
                                                        Source="/Resources/Picture/导入_128.png" />
                                                    <TextBlock
                                                        FontSize="25"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{DynamicResource ImportVideo}" />
                                                </StackPanel>

                                            </super:SimplePanel>

                                            <ProgressBar
                                                Width="auto"
                                                Height="2"
                                                Margin="10,2,10,0"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Top"
                                                Foreground="{DynamicResource Button.Fill.Background}"
                                                Style="{StaticResource NormalStaticProgressBar}"
                                                Visibility="{Binding Rendering, Converter={StaticResource BoolToVisibilityConverter}}"
                                                Value="{Binding RenderProgress, Mode=OneWay}" />

                                            <!--  影片  -->
                                            <ItemsControl
                                                x:Name="MovieItemsControl"
                                                Background="Transparent"
                                                FocusVisualStyle="{x:Null}"
                                                ItemTemplate="{StaticResource VideoDataTemplate}"
                                                ItemsSource="{Binding CurrentVideoList}"
                                                PreviewMouseWheel="MovieItemsControl_PreviewMouseWheel"
                                                ScrollViewer.ScrollChanged="ScrollViewer_ScrollChanged"
                                                Style="{StaticResource ItemsControlVirtualizedWrapPanelStyle}">

                                                <ItemsControl.Template>
                                                    <ControlTemplate>
                                                        <local:WheelSpeedScrollViewer
                                                            super:ScrollAnimationBehavior.IsEnabled="True"
                                                            super:ScrollAnimationBehavior.PointsToScroll="1"
                                                            super:ScrollAnimationBehavior.TimeDuration="00:00:00.5"
                                                            super:ScrollAnimationBehavior.VerticalOffset="0"
                                                            SpeedFactor="{Binding ScrollSpeedFactor, Mode=OneWay, Source={x:Static p:Settings.Default}}"
                                                            Style="{StaticResource FlatScrollViewer}">
                                                            <ItemsPresenter />
                                                        </local:WheelSpeedScrollViewer>

                                                        <!--<ScrollViewer
                                                            super:ScrollAnimationBehavior.IsEnabled="False"
                                                            super:ScrollAnimationBehavior.PointsToScroll="1"
                                                            super:ScrollAnimationBehavior.TimeDuration="00:00:00.05">
                                                            <ItemsPresenter />
                                                        </ScrollViewer>-->
                                                        <!--<super:SmoothScrollViewer>
                                                            <ItemsPresenter />
                                                        </super:SmoothScrollViewer>-->



                                                        <!--<ScrollViewer>
                                                            <ItemsPresenter />
                                                        </ScrollViewer>-->
                                                    </ControlTemplate>
                                                </ItemsControl.Template>
                                            </ItemsControl>

                                            <!--  去到顶部/底部  -->
                                            <super:GoToTop
                                                Margin="20,10"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Bottom"
                                                Panel.ZIndex="99"
                                                OnGoToBottom="GotoBottom"
                                                OnGoToTop="GotoTop" />
                                        </super:SimplePanel>
                                    </Grid>


                                    <!--  底部  -->
                                    <Grid
                                        Grid.Row="2"
                                        HorizontalAlignment="Stretch"
                                        Panel.ZIndex="5"
                                        Visibility="{Binding DisplayPage, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay, Source={x:Static p:Settings.Default}}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <super:Slider
                                            Name="imageSizeSlider"
                                            Grid.Column="0"
                                            Width="200"
                                            Margin="20,0,0,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            LargeChange="10"
                                            Maximum="800"
                                            Minimum="200"
                                            SmallChange="5"
                                            ValueChanged="ImageSizeSlider_ValueChanged"
                                            Value="{Binding Path=GlobalImageWidth, Source={x:Static p:Settings.Default}, Mode=TwoWay}" />

                                        <Grid Grid.Column="1" HorizontalAlignment="Right">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Border
                                                Grid.Column="0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Background="{DynamicResource Window.Side.Background}"
                                                CornerRadius="5">
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontSize="13"
                                                    Style="{StaticResource BaseTextBlock}">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="{} {0}/{1}">
                                                            <Binding Path="CurrentCount" />
                                                            <Binding Path="TotalCount" />
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </Border>


                                            <!--  页码  -->
                                            <super:Pagination
                                                Name="pagination"
                                                Grid.Column="1"
                                                CurrentPage="{Binding CurrentPage, Mode=OneWay}"
                                                CurrentPageChange="Pagination_CurrentPageChange"
                                                PageSize="{Binding PageSize, Source={x:Static p:Settings.Default}, Mode=TwoWay}"
                                                PageSizes="[10,20,40,50,100]"
                                                ShowCombobox="{Binding PaginationCombobox, Source={x:Static p:Settings.Default}}"
                                                Style="{StaticResource NormalPagination}"
                                                Total="{Binding TotalCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        </Grid>
                                    </Grid>

                                </Grid>

                            </TabItem>

                            <TabItem Header="{DynamicResource Label}">
                                <Grid Margin="10" HorizontalAlignment="Stretch">
                                    <ItemsControl
                                        Name="LabelListItemsControl"
                                        Margin="5"
                                        Background="Transparent"
                                        ItemsSource="{Binding LabelList}"
                                        ScrollViewer.VerticalScrollBarVisibility="Auto">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource RoundInfoBorder}">
                                                    <TextBlock
                                                        FontSize="14"
                                                        Foreground="{DynamicResource Window.Sub.Foreground}"
                                                        MouseUp="Label_MouseDown"
                                                        Style="{StaticResource BaseTextBlock}"
                                                        Text="{Binding}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>


                                </Grid>


                            </TabItem>
                            <TabItem Header="{DynamicResource Other}">
                                <Grid
                                    Margin="5"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    Background="Transparent">

                                    <!--  等待  -->
                                    <Grid
                                        Grid.Row="1"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Panel.ZIndex="10"
                                        Visibility="{Binding IsLoadingClassify, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <Grid MinWidth="150" MaxWidth="250">
                                            <Border
                                                Margin="5"
                                                Background="{DynamicResource Window.Foreground}"
                                                CornerRadius="5"
                                                Effect="{StaticResource NormalBlurEffect}" />

                                            <Border
                                                Margin="5"
                                                Background="{DynamicResource Window.InnerDialog.Background}"
                                                CornerRadius="5">

                                                <Grid Margin="5">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="*" />
                                                        <RowDefinition Height="auto" />
                                                    </Grid.RowDefinitions>
                                                    <StackPanel
                                                        Grid.Row="0"
                                                        Margin="20,10"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Orientation="Horizontal">
                                                        <super:LoadingCircle
                                                            Width="40"
                                                            Height="40"
                                                            DotSize="7"
                                                            Foreground="{DynamicResource Window.Foreground}" />
                                                        <TextBlock
                                                            Grid.Row="0"
                                                            MaxHeight="300"
                                                            Margin="10"
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"
                                                            Background="Transparent"
                                                            FontSize="18"
                                                            Foreground="{DynamicResource Window.Foreground}"
                                                            Style="{StaticResource BaseTextBlock}"
                                                            Text="{DynamicResource Loading}" />

                                                    </StackPanel>


                                                </Grid>


                                            </Border>
                                        </Grid>

                                    </Grid>



                                    <TabControl
                                        Grid.Row="1"
                                        Margin="5"
                                        Background="Transparent"
                                        BorderBrush="{DynamicResource Window.Foreground}"
                                        IsEnabled="{Binding IsLoadingClassify, Converter={StaticResource OppositeBooleanConverter}}"
                                        ItemContainerStyle="{StaticResource FlatTabItem}"
                                        SelectedIndex="{Binding ClassifySelectedIndex, Mode=TwoWay}"
                                        SelectionChanged="ClassifyTabControl_SelectionChanged"
                                        Style="{StaticResource FlatTabControl}"
                                        TabStripPlacement="Top">



                                        <TabItem Header="{DynamicResource Genre}">
                                            <ScrollViewer Margin="10">
                                                <ItemsControl
                                                    Margin="5"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding GenreList}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Name="LabelWrapPanel" Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>

                                                            <Border Style="{StaticResource RoundInfoBorder}">
                                                                <TextBlock
                                                                    ContextMenu="{StaticResource TextBlockContextMenu}"
                                                                    FontSize="14"
                                                                    Foreground="{DynamicResource Window.Sub.Foreground}"
                                                                    MouseLeftButtonUp="ShowSameString"
                                                                    Style="{StaticResource BaseTextBlock}"
                                                                    Text="{Binding}" />

                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>



                                        </TabItem>
                                        <TabItem Header="{DynamicResource Tag}">

                                            <ScrollViewer Margin="10">
                                                <ItemsControl
                                                    Margin="5"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding SeriesList}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Name="LabelWrapPanel" Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>

                                                            <Border Style="{StaticResource RoundInfoBorder}">
                                                                <TextBlock
                                                                    ContextMenu="{StaticResource TextBlockContextMenu}"
                                                                    FontSize="14"
                                                                    Foreground="{DynamicResource Window.Sub.Foreground}"
                                                                    MouseLeftButtonUp="ShowSameString"
                                                                    Style="{StaticResource BaseTextBlock}"
                                                                    Text="{Binding}" />
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>


                                            </ScrollViewer>



                                        </TabItem>
                                        <TabItem Header="{DynamicResource Studio}">

                                            <ScrollViewer Margin="10">
                                                <ItemsControl
                                                    Margin="5"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding StudioList}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Style="{StaticResource RoundInfoBorder}">
                                                                <TextBlock
                                                                    ContextMenu="{StaticResource TextBlockContextMenu}"
                                                                    FontSize="14"
                                                                    Foreground="{DynamicResource Window.Sub.Foreground}"
                                                                    MouseLeftButtonUp="ShowSameString"
                                                                    Style="{StaticResource BaseTextBlock}"
                                                                    Text="{Binding}" />
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>


                                            </ScrollViewer>



                                        </TabItem>

                                        <TabItem Header="{DynamicResource Director}">

                                            <ScrollViewer Margin="10">
                                                <ItemsControl
                                                    Margin="5"
                                                    Background="Transparent"
                                                    ItemsSource="{Binding DirectorList}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Orientation="Horizontal" />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>

                                                            <Border Style="{StaticResource RoundInfoBorder}">
                                                                <TextBlock
                                                                    ContextMenu="{StaticResource TextBlockContextMenu}"
                                                                    FontSize="14"
                                                                    Foreground="{DynamicResource Window.Sub.Foreground}"
                                                                    MouseLeftButtonUp="ShowSameString"
                                                                    Style="{StaticResource BaseTextBlock}"
                                                                    Text="{Binding}" />
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>


                                            </ScrollViewer>



                                        </TabItem>
                                    </TabControl>
                                </Grid>


                            </TabItem>
                        </TabControl>
                    </Grid>


                </Grid>

                <!--  首次运行显示扫描  -->
                <super:SimplePanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Panel.ZIndex="10"
                    Visibility="{Binding ShowFirstRun, FallbackValue=Hidden}">
                    <super:SimplePanel>
                        <Border
                            Margin="5"
                            Background="{DynamicResource Window.Foreground}"
                            CornerRadius="5"
                            Effect="{StaticResource NormalBlurEffect}" />

                        <Border
                            Margin="5"
                            Background="{DynamicResource Window.InnerDialog.Background}"
                            CornerRadius="5">

                            <StackPanel
                                Margin="40"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Panel.ZIndex="1"
                                FocusVisualStyle="{x:Null}"
                                Orientation="Horizontal"
                                Visibility="Visible">
                                <TextBlock
                                    Margin="20,0"
                                    VerticalAlignment="Center"
                                    FontSize="20"
                                    Style="{StaticResource BaseTextBlock}"
                                    Text="{DynamicResource DragFileInOr}" />
                                <Button Click="ImportVideo" Content="{DynamicResource Scan}" />
                            </StackPanel>
                        </Border>
                    </super:SimplePanel>

                    <super:HoverPath Click="HideBeginScanGrid" Style="{StaticResource CloseHoverPath}" />
                </super:SimplePanel>

            </Grid>
            <Grid
                Grid.Row="1"
                Height="30"
                Background="{DynamicResource Window.StatusBar.Background}"
                Visibility="{Binding DisplayStatusBar, Converter={StaticResource BoolToVisibilityConverter}, Mode=TwoWay, Source={x:Static p:Settings.Default}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBox
                        Margin="10,0"
                        Padding="0"
                        VerticalContentAlignment="Center"
                        FontSize="12"
                        Style="{StaticResource ReadOnlyNoWrapTextBox}"
                        Text="{Binding StatusText, Mode=OneWay}" />
                    <super:SysInfo />
                </StackPanel>
                <StackPanel
                    Grid.Column="2"
                    Margin="5,0"
                    Orientation="Horizontal">
                    <Grid Width="30" MouseLeftButtonUp="OpenServerWindow">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Cursor" Value="Hand" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{DynamicResource Window.StatusBar.Hover.Background}" />
                                    </Trigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="UnReady">
                                        <Setter Property="ToolTip" Value="后台服务未就绪" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="Starting">
                                        <Setter Property="ToolTip" Value="后台服务启动中" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ServerStatus}" Value="Ready">
                                        <Setter Property="ToolTip" Value="后台服务已就绪" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Viewbox
                            Width="20"
                            Height="18"
                            VerticalAlignment="Center">
                            <Path Data="M896 767H129c-35.3 0-64-28.7-64-64V128.3c0-35.3 28.7-64 64-64h767c35.3 0 64 28.7 64 64V703c0 35.3-28.7 64-64 64z m-766.9-64H896l0.1-0.1V128.4l-0.1-0.1H129.1l-0.1 0.1 0.1 574.6c-0.1 0-0.1 0 0 0z M383.1 592h-0.1c-27.5-0.1-41.8-27.8-48.8-41.2-8.1-15.6-16.4-35.9-24.5-55.5-6.4-15.6-13.1-31.7-19.3-44.7-2.3-4.8-4.2-8.6-5.9-11.6-4.8 3.8-11.3 9.9-19.8 19.4-11.8 13.2-20.5 25.3-20.6 25.4-10.3 14.4-30.3 17.7-44.6 7.4-14.4-10.3-17.7-30.3-7.4-44.6 0.5-0.7 12.8-17.9 28.9-35.2 26.7-28.8 49.1-42.2 70.3-42.4h0.3c13.1 0 25 6.2 35.3 18.4 5.1 6.1 10.3 14.1 15.7 24.5 8.8 16.8 17.7 38.3 26.2 59 3.7 9 8.9 21.6 14.1 33.3 8.3-17.2 17.6-38.2 24.5-53.5C451.2 352.3 473.9 305 511.6 305c34.4 0 63 34.2 105.9 90.5 7.4 9.7 17.3 22.7 24.9 31.6 11.1-9.8 33-32.8 72.2-85.5 32.6-43.8 60.5-85.9 60.8-86.3 9.7-14.7 29.6-18.8 44.3-9 14.7 9.7 18.8 29.6 9 44.3-1.3 2-32.7 49.4-69.2 97.7-21.7 28.8-40.8 52-56.5 68.7-26.8 28.5-45.3 40.1-63.9 40.1-17.9 0-31.3-12.5-43.2-25.9-8.9-10.1-18.8-23.1-29.4-37-11.9-15.6-24.2-31.8-35.9-44.9-6.2-7-11-11.7-14.5-14.8-3.8 5.6-9.1 14.6-16.3 28.8-11 21.6-22.7 47.9-34 73.3-11.5 25.8-22.3 50.1-32 68.8-5.8 11.2-10.7 19.3-15.3 25.6-3.8 5.3-15.5 21-35.4 21z m249.8-157.7z m-338.7-1.6z m213.5-64.3zM512.1 846.7c-38 0-74.1-7.6-101.7-21.4-33.1-16.5-51.3-40.5-51.3-67.6 0-13.8 11.2-25 25-25s25 11.2 25 25c0 13.7 39.1 38.9 103 38.9s103-25.2 103-38.9c0-13.8 11.2-25 25-25s25 11.2 25 25c0 27-18.2 51-51.3 67.6-27.6 13.8-63.7 21.4-101.7 21.4zM161 960c-17.7 0-32-14.3-32-32s14.3-32 32-32l703.4-0.7c17.7 0 32 14.3 32 32s-14.3 32-32 32L161 960z" Fill="{DynamicResource Window.Foreground}" />
                        </Viewbox>

                        <Border
                            Width="10"
                            Height="10"
                            Margin="2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            CornerRadius="5">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="Gray" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ServerStatus}" Value="UnReady">
                                            <Setter Property="Background" Value="Gray" />

                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ServerStatus}" Value="Starting">
                                            <Setter Property="Background" Value="{DynamicResource Common.HighLight.Deep.Background}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ServerStatus}" Value="Ready">
                                            <Setter Property="Background" Value="{DynamicResource CheckBox.Checked.Background}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>

                    </Grid>
                    <Grid>
                        <super:PathMsg
                            Name="screenShotPathMsg"
                            MouseLeftButtonUp="ShowScreenShotPopup"
                            MsgCount="{Binding ScreenShotTasks.Count}"
                            Path="M443.972267 437.316267L200.157867 117.3504a39.355733 39.355733 0 0 1 5.5296-53.6576 36.4544 36.4544 0 0 1 51.8144 3.754667l254.088533 291.908266 254.0544-291.9424a36.932267 36.932267 0 0 1 51.882667-3.754666 39.287467 39.287467 0 0 1 5.597866 53.76l-243.8144 319.931733 151.381334 174.1824a185.002667 185.002667 0 0 1 223.675733 81.749333 184.0128 184.0128 0 0 1-43.008 233.984 184.388267 184.388267 0 0 1-237.704533-2.7648 183.978667 183.978667 0 0 1-37.341867-234.973866 32.768 32.768 0 0 1-3.754667-4.608l-120.968533-158.378667-67.6864-89.1904 0.068267-0.034133z m-49.493334 57.002666l70.929067 92.8768-74.205867 97.621334c-1.4336 1.365333-2.389333 3.310933-3.754666 4.676266a184.490667 184.490667 0 0 1-275.114667 237.738667 184.558933 184.558933 0 0 1 180.736-315.733333l101.376-117.213867zM240.776533 894.976a110.011733 110.011733 0 0 0 91.5456-64.443733 111.616 111.616 0 0 0-11.707733-111.616 111.5136 111.5136 0 0 0-102.7072-44.373334 110.523733 110.523733 0 0 0-96.221867 121.4464 110.045867 110.045867 0 0 0 119.0912 98.986667z m541.7984 0a110.421333 110.421333 0 0 0 102.7072-44.3392 110.660267 110.660267 0 0 0-25.258666-155.921067 110.011733 110.011733 0 0 0-54.613334-19.729066 110.455467 110.455467 0 0 0-119.534933 98.542933 111.274667 111.274667 0 0 0 96.699733 121.4464z"
                            Style="{StaticResource NormalPathMsg}" />
                        <Popup
                            x:Name="screenShotStatusPopup"
                            Width="500"
                            MaxHeight="600"
                            AllowsTransparency="True"
                            HorizontalOffset="-450"
                            Placement="Top"
                            PlacementTarget="{Binding ElementName=downloadPathMsg}"
                            PopupAnimation="Fade"
                            StaysOpen="False"
                            VerticalOffset="0">
                            <Grid Margin="5">
                                <Border
                                    Margin="5"
                                    Background="{DynamicResource Menu.Background}"
                                    CornerRadius="0 0 5 5"
                                    Effect="{StaticResource PopupDropShadowEffect}" />
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="auto" />
                                    </Grid.RowDefinitions>
                                    <Grid
                                        Grid.Row="0"
                                        Height="35"
                                        Background="{DynamicResource Window.Title.Background}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock
                                            Margin="10,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource BaseTextBlock}"
                                            Text="{DynamicResource ScreenShotTask}" />

                                        <Button
                                            Grid.Column="1"
                                            Margin="5,0"
                                            BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                            Click="ShowContextMenu"
                                            Content="{DynamicResource ClearList}"
                                            Style="{StaticResource BorderButton}">
                                            <Button.ContextMenu>
                                                <ContextMenu HorizontalOffset="-70" VerticalOffset="5">
                                                    <MenuItem
                                                        Click="RemoveCompleteScreenShot"
                                                        Header="{DynamicResource Done}"
                                                        IsCheckable="False" />
                                                    <MenuItem
                                                        Click="RemoveCancelScreenShot"
                                                        Header="{DynamicResource Canceled}"
                                                        IsCheckable="False" />
                                                </ContextMenu>
                                            </Button.ContextMenu>
                                        </Button>

                                        <super:HoverPath
                                            Grid.Column="2"
                                            Width="20"
                                            Height="20"
                                            super:CommonExt.HoverBackground="{StaticResource Window.ToolsBar.Background}"
                                            Click="HideScreenShotPopup"
                                            Style="{StaticResource DownHoverPath}" />

                                    </Grid>


                                    <ItemsControl
                                        Grid.Row="1"
                                        Margin="10"
                                        ItemsSource="{Binding ScreenShotTasks}"
                                        Style="{StaticResource ItemsControlVirtualizedStyle}">

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Name="rootGrid" Cursor="Hand">
                                                    <Border
                                                        Margin="5"
                                                        Background="{DynamicResource Menu.Background}"
                                                        BorderThickness="1"
                                                        CornerRadius="5"
                                                        Effect="{StaticResource PopupDropShadowEffect}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ElementName=rootGrid, Path=IsMouseOver}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                    <Grid Margin="5">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="auto" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <fa:ImageAwesome
                                                            Grid.Column="0"
                                                            Width="30"
                                                            Margin="10"
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center">
                                                            <fa:ImageAwesome.Style>
                                                                <Style TargetType="fa:ImageAwesome">
                                                                    <Style.Triggers>

                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Canceled">
                                                                            <Setter Property="Icon" Value="TimesCircle" />
                                                                            <Setter Property="Foreground" Value="Red" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="WaitingToRun">
                                                                            <Setter Property="Icon" Value="Hourglass" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Control.Disabled.Background}" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                            <Setter Property="Icon" Value="CheckCircle" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Common.Status.Complete.Background}" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Running">
                                                                            <Setter Property="Icon" Value="Refresh" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Common.Status.Running.Background}" />
                                                                            <Setter Property="Spin" Value="True" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </fa:ImageAwesome.Style>
                                                        </fa:ImageAwesome>


                                                        <StackPanel
                                                            Grid.Column="1"
                                                            MaxWidth="280"
                                                            Margin="5"
                                                            Orientation="Vertical">
                                                            <TextBlock
                                                                Margin="5"
                                                                HorizontalAlignment="Left"
                                                                FontSize="15"
                                                                FontWeight="Bold"
                                                                Text="{Binding Title}"
                                                                TextTrimming="WordEllipsis"
                                                                ToolTip="{Binding Title}" />
                                                            <ProgressBar
                                                                Height="2"
                                                                Margin="5,0"
                                                                Maximum="100"
                                                                Value="{Binding Progress}">
                                                                <ProgressBar.Style>
                                                                    <Style BasedOn="{StaticResource NormalStaticProgressBar}" TargetType="ProgressBar">
                                                                        <Style.Triggers>



                                                                            <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                                <Setter Property="Visibility" Value="Hidden" />
                                                                            </DataTrigger>

                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </ProgressBar.Style>
                                                            </ProgressBar>
                                                            <Grid>
                                                                <TextBlock
                                                                    Margin="5"
                                                                    FontSize="10"
                                                                    Style="{StaticResource BaseTextBlock}"
                                                                    Text="{Binding CreateTime}"
                                                                    TextAlignment="Left" />
                                                                <TextBlock
                                                                    Margin="5"
                                                                    HorizontalAlignment="Right"
                                                                    Text="{Binding Progress, StringFormat=\{0\} %}">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                                    <Setter Property="Visibility" Value="Hidden" />
                                                                                </DataTrigger>

                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </Grid>
                                                            <StackPanel Margin="5" Orientation="Horizontal">
                                                                <TextBlock Text="{Binding StatusText}" />
                                                                <TextBlock Foreground="Red" Text="{Binding Message, StringFormat='   {0} '}" />

                                                            </StackPanel>



                                                        </StackPanel>
                                                        <StackPanel
                                                            Grid.Column="2"
                                                            Width="100"
                                                            HorizontalAlignment="Right"
                                                            VerticalAlignment="Center"
                                                            Orientation="Vertical">
                                                            <StackPanel.Style>
                                                                <Style TargetType="StackPanel">
                                                                    <Setter Property="Visibility" Value="Hidden" />

                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding ElementName=rootGrid, Path=IsMouseOver}" Value="True">
                                                                            <Setter Property="Visibility" Value="Visible" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </StackPanel.Style>
                                                            <Button
                                                                MinWidth="80"
                                                                Margin="6"
                                                                HorizontalAlignment="Right"
                                                                Click="CancelScreenShotTask"
                                                                Content="{DynamicResource Cancel}"
                                                                Tag="{Binding DataID}">
                                                                <Button.Style>
                                                                    <Style BasedOn="{StaticResource ButtonDanger}" TargetType="Button">
                                                                        <Setter Property="IsEnabled" Value="False" />
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Running">
                                                                                <Setter Property="IsEnabled" Value="True" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>

                                                                    </Style>
                                                                </Button.Style>
                                                            </Button>

                                                            <Button
                                                                MinWidth="80"
                                                                Margin="6,0"
                                                                HorizontalAlignment="Right"
                                                                Click="ShowScreenShotDetail"
                                                                Content="{DynamicResource Detail}"
                                                                Style="{StaticResource ButtonPrimary}"
                                                                Tag="{Binding DataID}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>

                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>


                                    </ItemsControl>



                                    <StackPanel
                                        Grid.Row="2"
                                        Orientation="Vertical"
                                        Visibility="{Binding ScreenShotVisibility}">

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <ProgressBar
                                                Grid.Column="0"
                                                Height="4"
                                                Margin="10,0"
                                                Maximum="100"
                                                Minimum="0"
                                                Style="{StaticResource NormalStaticProgressBar}"
                                                Value="{Binding ScreenShotProgress}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                MinWidth="50"
                                                Margin="10,0"
                                                Text="{Binding ScreenShotProgress, StringFormat=\{0\} %}" />
                                        </Grid>

                                        <StackPanel Orientation="Horizontal">
                                            <Button
                                                Click="CancelScreenShotTasks"
                                                Content="{DynamicResource CancelALl}"
                                                Style="{StaticResource ButtonDanger}" />
                                        </StackPanel>
                                    </StackPanel>




                                </Grid>
                            </Grid>
                        </Popup>
                    </Grid>
                    <Grid>

                        <Border
                            Name="msgScan"
                            Width="30"
                            Height="30"
                            Margin="0"
                            MouseLeftButtonUp="ShowMsgScanPopup">
                            <Border.Style>
                                <Style BasedOn="{StaticResource FlatBorderStyle}" TargetType="Border">
                                    <Setter Property="Background" Value="Transparent" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource Window.StatusBar.Hover.Background}" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <Viewbox Height="15" Margin="-5,0,0,0">
                                <Path Data="M232 64c-30.928 0-56 25.072-56 56v784c0 30.928 25.072 56 56 56h560c30.928 0 56-25.072 56-56V120c0-30.928-25.072-56-56-56H232z m0 840V120h560v784H232z m112-736h-64v64h64V168z m168 120c-123.712 0-224 100.288-224 224s100.288 224 224 224 224-100.288 224-224-100.288-224-224-224z m-168 224c0-92.784 75.216-168 168-168s168 75.216 168 168-75.216 168-168 168-168-75.216-168-168z m168-112c-61.856 0-112 50.144-112 112s50.144 112 112 112 112-50.144 112-112-50.144-112-112-112zM744 168h-64v64h64V168zM316 792v56h392v-56H316z" Fill="{DynamicResource Window.Foreground}" />

                            </Viewbox>
                        </Border>
                        <Viewbox
                            Height="14"
                            Margin="3"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom">
                            <Path RenderTransformOrigin="0.5,0.5">
                                <Path.RenderTransform>
                                    <RotateTransform CenterX="0" CenterY="0" />
                                </Path.RenderTransform>
                                <Path.Style>
                                    <Style TargetType="Path">
                                        <Setter Property="Visibility" Value="Hidden" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ScanStatus}" Value="Scanning">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation
                                                                RepeatBehavior="Forever"
                                                                Storyboard.TargetProperty="RenderTransform.Angle"
                                                                From="0"
                                                                To="360"
                                                                Duration="0:0:1" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation
                                                                Storyboard.TargetProperty="RenderTransform.Angle"
                                                                To="0"
                                                                Duration="0:0:0" />
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.ExitActions>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Fill" Value="{DynamicResource Common.Status.Running.Background}" />
                                                <Setter Property="Data" Value="M171.292444 548.977778a337.464889 337.464889 0 0 1 210.488889-367.445334c111.616-43.52 231.992889-22.698667 317.212445 39.480889L626.460444 338.488889l325.233778-1.251556L835.470222 0l-59.562666 96.426667C650.353778 15.075556 479.175111-11.491556 329.272889 46.933333 121.628444 127.886222 2.048 337.351111 25.6 549.034667h145.635556zM852.764444 465.009778a337.464889 337.464889 0 0 1-210.488888 367.502222c-102.627556 39.992889-215.836444 24.917333-302.819556-29.013333l65.536-106.211556-349.752889-20.48L203.093333 1024l62.065778-100.465778c125.553778 81.351111 279.608889 102.001778 429.511111 43.52 207.644444-80.952889 327.224889-290.304 303.616-502.044444h-145.635555z" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ScanStatus}" Value="Complete">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="Fill" Value="{DynamicResource Common.Status.Complete.Background}" />
                                                <Setter Property="Data" Value="M947.605 139.803c-15.766-15.763-39.836-14.107-57.1 0-133.71 109.263-541.798 419.618-541.798 419.618s-165.018-71.128-216.268-94.163c-20.338-9.14-41.328-15.766-57.101 0-15.763 15.763-15.763 41.326 0 57.087 0 0 242.992 244.252 244.157 245.415 8.052 8.052 18.652 11.867 29.212 11.693 10.554 0.175 21.154-3.64 29.211-11.693 1.159-1.163 427.18-428.238 569.686-570.87 15.759-15.772 15.768-41.324 0.001-57.087z m0 0" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ScanStatus}" Value="None">
                                                <Setter Property="Visibility" Value="Hidden" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>

                        </Viewbox>
                        <Popup
                            x:Name="scanStatusPopup"
                            Width="400"
                            MaxHeight="600"
                            AllowsTransparency="True"
                            HorizontalOffset="-350"
                            Placement="Top"
                            PlacementTarget="{Binding ElementName=msgScan}"
                            PopupAnimation="Fade"
                            StaysOpen="False"
                            VerticalOffset="0">
                            <Grid Margin="5">
                                <Border
                                    Margin="5"
                                    Background="{DynamicResource Menu.Background}"
                                    CornerRadius="0 0 5 5"
                                    Effect="{StaticResource PopupDropShadowEffect}" />
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid
                                        Grid.Row="0"
                                        Height="35"
                                        Background="{DynamicResource Window.Title.Background}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock
                                            Margin="10,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource BaseTextBlock}"
                                            Text="{DynamicResource ScanTask}" />

                                        <super:HoverPath
                                            Grid.Column="1"
                                            Width="23"
                                            Height="23"
                                            Margin="0"
                                            Click="ClearScanTasks"
                                            Style="{StaticResource DeleteHoverPath}" />
                                        <super:HoverPath
                                            Grid.Column="2"
                                            Width="20"
                                            Height="20"
                                            super:CommonExt.HoverBackground="{StaticResource Window.ToolsBar.Background}"
                                            Click="HideScanPopup"
                                            Style="{StaticResource DownHoverPath}" />
                                    </Grid>

                                    <ItemsControl
                                        Grid.Row="1"
                                        Margin="10"
                                        ItemsSource="{Binding ScanTasks}"
                                        Style="{StaticResource ItemsControlVirtualizedStyle}">

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Name="rootGrid" Cursor="Hand">
                                                    <Grid.ContextMenu>
                                                        <ContextMenu>
                                                            <MenuItem
                                                                Click="OpenScanPath"
                                                                Header="{DynamicResource OpenPath}"
                                                                Tag="{Binding Message}" />
                                                        </ContextMenu>
                                                    </Grid.ContextMenu>
                                                    <Border
                                                        Margin="5"
                                                        Background="{DynamicResource Menu.Background}"
                                                        BorderThickness="1"
                                                        CornerRadius="5"
                                                        Effect="{StaticResource PopupDropShadowEffect}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ElementName=rootGrid, Path=IsMouseOver}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                    <Grid Margin="5">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="auto" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <fa:ImageAwesome
                                                            Grid.Column="0"
                                                            Width="30"
                                                            Margin="10"
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center">
                                                            <fa:ImageAwesome.Style>
                                                                <Style TargetType="fa:ImageAwesome">
                                                                    <Style.Triggers>

                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Canceled">
                                                                            <Setter Property="Icon" Value="TimesCircle" />
                                                                            <Setter Property="Foreground" Value="Red" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="WaitingToRun">
                                                                            <Setter Property="Icon" Value="Hourglass" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Control.Disabled.Background}" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                            <Setter Property="Icon" Value="CheckCircle" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Common.Status.Complete.Background}" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Running">
                                                                            <Setter Property="Icon" Value="Refresh" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Common.Status.Running.Background}" />
                                                                            <Setter Property="Spin" Value="True" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </fa:ImageAwesome.Style>

                                                        </fa:ImageAwesome>

                                                        <StackPanel
                                                            Grid.Column="1"
                                                            Margin="5"
                                                            Orientation="Vertical">



                                                            <TextBlock
                                                                Grid.Column="1"
                                                                Margin="5,10"
                                                                FontSize="14"
                                                                FontWeight="Bold"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="{Binding Message}"
                                                                TextAlignment="Left"
                                                                TextTrimming="WordEllipsis"
                                                                TextWrapping="NoWrap" />
                                                            <TextBlock
                                                                Margin="5,10"
                                                                FontSize="10"
                                                                Foreground="{DynamicResource Window.Sub.Foreground}"
                                                                Style="{StaticResource BaseTextBlock}"
                                                                Text="{Binding CreateTime}"
                                                                TextAlignment="Left"
                                                                TextTrimming="WordEllipsis"
                                                                TextWrapping="NoWrap" />


                                                        </StackPanel>
                                                        <StackPanel
                                                            Grid.Column="2"
                                                            Width="auto"
                                                            Margin="5,0"
                                                            VerticalAlignment="Center"
                                                            Orientation="Vertical">
                                                            <StackPanel.Style>
                                                                <Style TargetType="StackPanel">
                                                                    <Setter Property="Visibility" Value="Hidden" />

                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding ElementName=rootGrid, Path=IsMouseOver}" Value="True">
                                                                            <Setter Property="Visibility" Value="Visible" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </StackPanel.Style>
                                                            <Button
                                                                Margin="0,4"
                                                                Click="CancelScanTask"
                                                                Content="{DynamicResource Cancel}"
                                                                IsEnabled="{Binding Running}"
                                                                Style="{StaticResource ButtonDanger}"
                                                                Tag="{Binding CreateTime}" />
                                                            <Button
                                                                Click="ShowScanDetail"
                                                                Content="{DynamicResource Result}"
                                                                IsEnabled="{Binding Running, Converter={StaticResource OppositeBooleanConverter}}"
                                                                Tag="{Binding CreateTime}" />
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>

                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>


                                    </ItemsControl>







                                </Grid>
                            </Grid>
                        </Popup>
                        <Popup
                            AllowsTransparency="True"
                            HorizontalOffset="-260"
                            Placement="Top"
                            PlacementTarget="{Binding ElementName=msgScan}"
                            PopupAnimation="Fade"
                            VerticalOffset="0">
                            <Popup.Style>
                                <Style TargetType="Popup">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ScanStatus}" Value="Scanning">
                                            <Setter Property="IsOpen" Value="True" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Popup.Style>
                            <super:SimplePanel Margin="5">
                                <Border
                                    Width="300"
                                    Height="80"
                                    Margin="0,0,0,15"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Bottom"
                                    Background="{DynamicResource Window.Title.Background}"
                                    CornerRadius="5"
                                    Effect="{StaticResource PopupDropShadowEffect}">
                                    <Viewbox
                                        Width="40"
                                        Height="auto"
                                        Margin="0,0,10,-12"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom">
                                        <Path
                                            Data="M 10 10 L 50 10 30 40 Z"
                                            Fill="{DynamicResource Window.Title.Background}"
                                            Stroke="{DynamicResource Window.Title.Background}"
                                            StrokeLineJoin="Round"
                                            StrokeThickness="5" />
                                    </Viewbox>
                                </Border>


                                <Grid Margin="5">
                                    <TextBlock
                                        Margin="25"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Style="{StaticResource BaseTextBlock}"
                                        Text="扫描任务已添加" />
                                </Grid>
                            </super:SimplePanel>
                        </Popup>
                    </Grid>
                    <Grid>
                        <super:PathMsg
                            Name="downloadPathMsg"
                            MouseLeftButtonUp="ShowDownloadPopup"
                            MsgCount="{Binding DownLoadTasks.Count}"
                            Path="M942.545455 676.584727a34.909091 34.909091 0 0 1 34.90909 34.909091v139.636364c0 70.562909-57.437091 128-128 128h-674.90909a128.139636 128.139636 0 0 1-128-128v-139.636364a34.909091 34.909091 0 1 1 69.818181 0v139.636364c0 32.046545 26.088727 58.181818 58.181819 58.181818h674.90909c32.093091 0 58.181818-26.135273 58.181819-58.181818v-139.636364a34.909091 34.909091 0 0 1 34.909091-34.909091z m-455.214546 129.396364l-164.584727-164.561455a34.909091 34.909091 0 1 1 49.361454-49.361454l104.983273 104.96V81.454545a34.909091 34.909091 0 1 1 69.818182 0v615.563637l104.96-104.96a34.909091 34.909091 0 1 1 49.361454 49.361454l-164.538181 164.561455a34.792727 34.792727 0 0 1-24.669091 10.216727c-8.96 0-17.873455-3.397818-24.715637-10.216727z"
                            Style="{StaticResource NormalPathMsg}" />
                        <Popup
                            x:Name="downloadStatusPopup"
                            Width="500"
                            MaxHeight="600"
                            AllowsTransparency="True"
                            HorizontalOffset="-450"
                            Placement="Top"
                            PlacementTarget="{Binding ElementName=downloadPathMsg}"
                            PopupAnimation="Fade"
                            StaysOpen="False"
                            VerticalOffset="0">
                            <Grid Margin="5">
                                <Border
                                    Margin="5"
                                    Background="{DynamicResource Menu.Background}"
                                    CornerRadius="0 0 5 5"
                                    Effect="{StaticResource PopupDropShadowEffect}" />
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="auto" />
                                    </Grid.RowDefinitions>
                                    <Grid
                                        Grid.Row="0"
                                        Height="35"
                                        Background="{DynamicResource Window.Title.Background}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock
                                            Margin="10,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource BaseTextBlock}"
                                            Text="{DynamicResource DownloadTask}" />

                                        <Button
                                            Grid.Column="1"
                                            BorderBrush="{DynamicResource Button.Selected.BorderBrush}"
                                            Click="ShowContextMenu"
                                            Content="{DynamicResource ClearList}"
                                            Style="{StaticResource BorderButton}">
                                            <Button.ContextMenu>
                                                <ContextMenu HorizontalOffset="-70" VerticalOffset="5">
                                                    <MenuItem
                                                        Click="RemoveCompleteTask"
                                                        Header="{DynamicResource Done}"
                                                        IsCheckable="False" />
                                                    <MenuItem
                                                        Click="RemoveCancelTask"
                                                        Header="{DynamicResource Canceled}"
                                                        IsCheckable="False" />
                                                </ContextMenu>
                                            </Button.ContextMenu>
                                        </Button>

                                        <super:HoverPath
                                            Grid.Column="2"
                                            Width="20"
                                            Height="20"
                                            super:CommonExt.HoverBackground="{StaticResource Window.ToolsBar.Background}"
                                            Click="HideDownloadPopup"
                                            Style="{StaticResource DownHoverPath}" />
                                    </Grid>

                                    <ItemsControl
                                        Grid.Row="1"
                                        Margin="10"
                                        ItemsSource="{Binding DownLoadTasks}"
                                        Style="{StaticResource ItemsControlVirtualizedStyle}">

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Name="rootGrid" Cursor="Hand">
                                                    <Border
                                                        Margin="5"
                                                        Background="{DynamicResource Menu.Background}"
                                                        BorderThickness="1"
                                                        CornerRadius="5"
                                                        Effect="{StaticResource PopupDropShadowEffect}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ElementName=rootGrid, Path=IsMouseOver}" Value="True">
                                                                        <Setter Property="BorderBrush" Value="{DynamicResource Button.Selected.BorderBrush}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                    <Grid Margin="5">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="auto" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <fa:ImageAwesome
                                                            Grid.Column="0"
                                                            Width="30"
                                                            Margin="10"
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center">
                                                            <fa:ImageAwesome.Style>
                                                                <Style TargetType="fa:ImageAwesome">
                                                                    <Style.Triggers>

                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Canceled">
                                                                            <Setter Property="Icon" Value="TimesCircle" />
                                                                            <Setter Property="Foreground" Value="Red" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="WaitingToRun">
                                                                            <Setter Property="Icon" Value="Hourglass" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Control.Disabled.Background}" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                            <Setter Property="Icon" Value="CheckCircle" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Common.Status.Complete.Background}" />
                                                                            <Setter Property="Spin" Value="False" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="Running">
                                                                            <Setter Property="Icon" Value="Refresh" />
                                                                            <Setter Property="Foreground" Value="{DynamicResource Common.Status.Running.Background}" />
                                                                            <Setter Property="Spin" Value="True" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </fa:ImageAwesome.Style>
                                                        </fa:ImageAwesome>


                                                        <StackPanel
                                                            Grid.Column="1"
                                                            MaxWidth="280"
                                                            Margin="5"
                                                            Orientation="Vertical">
                                                            <TextBlock
                                                                Margin="5"
                                                                HorizontalAlignment="Left"
                                                                FontSize="15"
                                                                FontWeight="Bold"
                                                                Text="{Binding Title}"
                                                                TextTrimming="WordEllipsis"
                                                                ToolTip="{Binding Title}" />
                                                            <ProgressBar
                                                                Height="2"
                                                                Margin="5,0"
                                                                Maximum="100"
                                                                Value="{Binding Progress}">
                                                                <ProgressBar.Style>
                                                                    <Style BasedOn="{StaticResource NormalStaticProgressBar}" TargetType="ProgressBar">
                                                                        <Style.Triggers>



                                                                            <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                                <Setter Property="Visibility" Value="Hidden" />
                                                                            </DataTrigger>

                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </ProgressBar.Style>
                                                            </ProgressBar>
                                                            <Grid>
                                                                <TextBlock
                                                                    Margin="5"
                                                                    FontSize="10"
                                                                    Foreground="{DynamicResource Window.Sub.Foreground}"
                                                                    Style="{StaticResource BaseTextBlock}"
                                                                    Text="{Binding CreateTime}"
                                                                    TextAlignment="Left" />
                                                                <TextBlock
                                                                    Margin="5"
                                                                    HorizontalAlignment="Right"
                                                                    Text="{Binding Progress, StringFormat=\{0\} %}">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding Status, Mode=OneWay}" Value="RanToCompletion">
                                                                                    <Setter Property="Visibility" Value="Hidden" />
                                                                                </DataTrigger>

                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </Grid>
                                                            <StackPanel Margin="5" Orientation="Horizontal">
                                                                <TextBlock Text="{Binding StatusText}" />
                                                                <TextBlock
                                                                    Width="150"
                                                                    VerticalAlignment="Center"
                                                                    Foreground="Red"
                                                                    Text="{Binding Message, StringFormat='    {0} '}"
                                                                    TextTrimming="WordEllipsis"
                                                                    TextWrapping="NoWrap"
                                                                    ToolTip="{Binding Message}" />

                                                            </StackPanel>



                                                        </StackPanel>
                                                        <WrapPanel
                                                            Grid.Column="2"
                                                            Width="100"
                                                            VerticalAlignment="Center"
                                                            Orientation="Horizontal">
                                                            <WrapPanel.Style>
                                                                <Style TargetType="WrapPanel">
                                                                    <Setter Property="Visibility" Value="Hidden" />

                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding ElementName=rootGrid, Path=IsMouseOver}" Value="True">
                                                                            <Setter Property="Visibility" Value="Visible" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </WrapPanel.Style>
                                                            <Button
                                                                Margin="2"
                                                                Click="CancelDownloadTask"
                                                                Content="{DynamicResource Cancel}"
                                                                IsEnabled="{Binding Running}"
                                                                Style="{StaticResource ButtonDanger}"
                                                                Tag="{Binding DataID}" />
                                                            <Button
                                                                Margin="2"
                                                                Click="RestartTask"
                                                                Content="{DynamicResource Reboot}"
                                                                IsEnabled="{Binding Running, Converter={StaticResource OppositeBooleanConverter}}"
                                                                Tag="{Binding DataID}" />
                                                            <Button
                                                                Margin="2"
                                                                Click="ShowDownloadDetail"
                                                                Content="{DynamicResource Detail}"
                                                                Tag="{Binding DataID}" />
                                                        </WrapPanel>
                                                    </Grid>
                                                </Grid>

                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>



                                    <StackPanel Grid.Row="2" Orientation="Vertical">

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="auto" />
                                            </Grid.ColumnDefinitions>
                                            <ProgressBar
                                                Grid.Column="0"
                                                Height="4"
                                                Margin="10,0"
                                                Maximum="100"
                                                Minimum="0"
                                                Style="{StaticResource NormalStaticProgressBar}"
                                                Visibility="{Binding DownLoadVisibility}"
                                                Value="{Binding DownLoadProgress}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                Margin="10,0"
                                                Text="{Binding DownLoadProgress, StringFormat=\{0\} %}"
                                                Visibility="{Binding DownLoadVisibility}" />
                                        </Grid>

                                        <Border
                                            Margin="0"
                                            CornerRadius="0 0 5 5"
                                            Style="{StaticResource InfoBorder}">



                                            <StackPanel Orientation="Horizontal">
                                                <Button
                                                    Margin="20,10"
                                                    Click="CancelDownloadTasks"
                                                    Content="{DynamicResource CancelALl}"
                                                    Style="{StaticResource ButtonDanger}" />
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    Text="{Binding Path=DownloadLongTaskDelay, StringFormat=防止服务器屏蔽，随机暂停 {0} s}"
                                                    Visibility="{Binding DisplayDownloadLongTaskDelay}" />
                                            </StackPanel>
                                        </Border>

                                    </StackPanel>




                                </Grid>
                            </Grid>
                        </Popup>
                    </Grid>
                    <Grid>
                        <super:PathMsg
                            Name="msgPathMsg"
                            MouseLeftButtonUp="ShowMessage"
                            MsgCount="{Binding Message.Count}"
                            Path="M864 64H160C107.072 64 64 107.072 64 160v608c0 52.928 43.072 96 96 96h61.92v123.232L443.84 864H864c52.928 0 96-43.072 96-96V160c0-52.928-43.072-96-96-96z m32 704a32 32 0 0 1-32 32H443.84c-10.912 0-21.664 2.816-31.072 8.064l-126.88 70.4V864c0-35.296-28.704-64-64-64H160c-17.632 0-32-14.336-32-32V160c0-17.632 14.368-32 32-32h704c17.664 0 32 14.368 32 32v608z M640 520H256a32 32 0 1 0 0 64h384a32 32 0 1 0 0-64zM768 296H256a32 32 0 0 0 0 64h512a32 32 0 1 0 0-64z"
                            Style="{StaticResource NormalPathMsg}" />
                        <Popup
                            x:Name="msgPopup"
                            Width="550"
                            MaxHeight="600"
                            AllowsTransparency="True"
                            HorizontalOffset="-520"
                            Placement="Top"
                            PlacementTarget="{Binding ElementName=msgPathMsg}"
                            PopupAnimation="Fade"
                            StaysOpen="False"
                            VerticalOffset="0">
                            <Grid Margin="5">
                                <Border
                                    Margin="5"
                                    Background="{DynamicResource Menu.Background}"
                                    CornerRadius="0 0 5 5"
                                    Effect="{StaticResource PopupDropShadowEffect}" />
                                <Grid Margin="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid
                                        Grid.Row="0"
                                        Height="35"
                                        Background="{DynamicResource Window.Title.Background}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock
                                            Margin="10,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Style="{StaticResource BaseTextBlock}"
                                            Text="{DynamicResource RecentMsg}" />

                                        <super:HoverPath
                                            Grid.Column="1"
                                            Width="23"
                                            Height="23"
                                            Margin="0"
                                            Click="ClearMsg"
                                            Style="{StaticResource DeleteHoverPath}" />

                                        <super:HoverPath
                                            Grid.Column="2"
                                            Width="20"
                                            Height="20"
                                            super:CommonExt.HoverBackground="{StaticResource Window.ToolsBar.Background}"
                                            Click="HideMsgPopup"
                                            Style="{StaticResource DownHoverPath}" />


                                    </Grid>

                                    <ItemsControl
                                        Grid.Row="1"
                                        Margin="10"
                                        AlternationCount="99999"
                                        ItemsSource="{Binding Message}"
                                        Style="{StaticResource ItemsControlVirtualizedStyle}">

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <super:MessageCard
                                                    Close="MessageCard_Close"
                                                    Foreground="{DynamicResource Window.Foreground}"
                                                    Message="{Binding Text}"
                                                    MessageType="{Binding Type}"
                                                    Tag="{Binding Date}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>


                                    </ItemsControl>







                                </Grid>
                            </Grid>
                        </Popup>
                    </Grid>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</super:BaseWindow>
